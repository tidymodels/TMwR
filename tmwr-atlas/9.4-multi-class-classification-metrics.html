<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="9.4 Multi-Class Classification Metrics | Tidy Modeling with R" />
<meta property="og:type" content="book" />
<meta property="og:image" content="/images/cover.png" />
<meta property="og:description" content="The tidymodels framework is a collection of R packages for modeling and machine learning using tidyverse principles. This book provides a thorough introduction to how to use tidymodels, and an outline of good methodology and statistical practice for phases of the modeling process." />
<meta name="github-repo" content="tidymodels/TMwR" />

<meta name="author" content="Max Kuhn and Julia Silge" />


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta name="description" content="The tidymodels framework is a collection of R packages for modeling and machine learning using tidyverse principles. This book provides a thorough introduction to how to use tidymodels, and an outline of good methodology and statistical practice for phases of the modeling process.">

<title>9.4 Multi-Class Classification Metrics | Tidy Modeling with R</title>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="libs/navigation-1.1/tabsets.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
/* show arrow before summary tag as in bootstrap
TODO: remove if boostrap in updated in html_document (rmarkdown#1485) */
details > summary {
  display: list-item;
  cursor: pointer;
}
</style>
</head>

<body>

<div class="container-fluid main-container">


<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li class="has-sub"><a href="index.html#hello-world">Hello World</a>
<ul>
<li><a href="acknowledgments.html#acknowledgments">Acknowledgments</a></li>
<li><a href="using-code-examples.html#using-code-examples">Using Code Examples</a></li>
</ul></li>
<li class="part"><span><b>Introduction</b></span></li>
<li class="has-sub"><a href="1-software-modeling.html#software-modeling"><span class="toc-section-number">1</span> Software for modeling</a>
<ul>
<li><a href="1.1-fundamentals-for-modeling-software.html#fundamentals-for-modeling-software"><span class="toc-section-number">1.1</span> Fundamentals for Modeling Software</a></li>
<li class="has-sub"><a href="1.2-model-types.html#model-types"><span class="toc-section-number">1.2</span> Types of Models</a>
<ul>
<li><a href="1.2-model-types.html#descriptive-models">Descriptive models</a></li>
<li><a href="1.2-model-types.html#inferential-models">Inferential models</a></li>
<li><a href="1.2-model-types.html#predictive-models">Predictive models</a></li>
</ul></li>
<li><a href="1.3-connections-between-types-of-models.html#connections-between-types-of-models"><span class="toc-section-number">1.3</span> Connections Between Types of Models</a></li>
<li><a href="1.4-model-terminology.html#model-terminology"><span class="toc-section-number">1.4</span> Some Terminology</a></li>
<li><a href="1.5-model-phases.html#model-phases"><span class="toc-section-number">1.5</span> How Does Modeling Fit into the Data Analysis Process?</a></li>
<li><a href="1.6-software-summary.html#software-summary"><span class="toc-section-number">1.6</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="2-tidyverse.html#tidyverse"><span class="toc-section-number">2</span> A Tidyverse Primer</a>
<ul>
<li class="has-sub"><a href="2.1-tidyverse-principles.html#tidyverse-principles"><span class="toc-section-number">2.1</span> Tidyverse Principles</a>
<ul>
<li><a href="2.1-tidyverse-principles.html#design-for-humans"><span class="toc-section-number">2.1.1</span> Design for humans</a></li>
<li><a href="2.1-tidyverse-principles.html#reuse-existing-data-structures"><span class="toc-section-number">2.1.2</span> Reuse existing data structures</a></li>
<li><a href="2.1-tidyverse-principles.html#design-for-the-pipe-and-functional-programming"><span class="toc-section-number">2.1.3</span> Design for the pipe and functional programming</a></li>
</ul></li>
<li><a href="2.2-examples-of-tidyverse-syntax.html#examples-of-tidyverse-syntax"><span class="toc-section-number">2.2</span> Examples of Tidyverse Syntax</a></li>
<li><a href="2.3-chapter-summary.html#chapter-summary"><span class="toc-section-number">2.3</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="3-base-r.html#base-r"><span class="toc-section-number">3</span> A Review of R Modeling Fundamentals</a>
<ul>
<li><a href="3.1-an-example.html#an-example"><span class="toc-section-number">3.1</span> An Example</a></li>
<li><a href="3.2-formula.html#formula"><span class="toc-section-number">3.2</span> What Does the R Formula Do?</a></li>
<li><a href="3.3-tidiness-modeling.html#tidiness-modeling"><span class="toc-section-number">3.3</span> Why Tidiness is Important for Modeling</a></li>
<li><a href="3.4-combining-base-r-models-and-the-tidyverse.html#combining-base-r-models-and-the-tidyverse"><span class="toc-section-number">3.4</span> Combining Base R Models and the Tidyverse</a></li>
<li><a href="3.5-the-tidymodels-metapackage.html#the-tidymodels-metapackage"><span class="toc-section-number">3.5</span> The tidymodels Metapackage</a></li>
<li><a href="3.6-chapter-summary-1.html#chapter-summary-1"><span class="toc-section-number">3.6</span> Chapter Summary</a></li>
</ul></li>
<li class="part"><span><b>Modeling Basics</b></span></li>
<li class="has-sub"><a href="4-ames.html#ames"><span class="toc-section-number">4</span> The Ames Housing Data</a>
<ul>
<li><a href="4.1-exploring-features-of-homes-in-ames.html#exploring-features-of-homes-in-ames"><span class="toc-section-number">4.1</span> Exploring Features of Homes in Ames</a></li>
<li><a href="4.2-ames-summary.html#ames-summary"><span class="toc-section-number">4.2</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="5-splitting.html#splitting"><span class="toc-section-number">5</span> Spending our Data</a>
<ul>
<li><a href="5.1-splitting-methods.html#splitting-methods"><span class="toc-section-number">5.1</span> Common Methods for Splitting Data</a></li>
<li><a href="5.2-what-about-a-validation-set.html#what-about-a-validation-set"><span class="toc-section-number">5.2</span> What About a Validation Set?</a></li>
<li><a href="5.3-multi-level-data.html#multi-level-data"><span class="toc-section-number">5.3</span> Multi-Level Data</a></li>
<li><a href="5.4-other-considerations-for-a-data-budget.html#other-considerations-for-a-data-budget"><span class="toc-section-number">5.4</span> Other Considerations for a Data Budget</a></li>
<li><a href="5.5-splitting-summary.html#splitting-summary"><span class="toc-section-number">5.5</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="6-models.html#models"><span class="toc-section-number">6</span> Fitting Models with parsnip</a>
<ul>
<li><a href="6.1-create-a-model.html#create-a-model"><span class="toc-section-number">6.1</span> Create a Model</a></li>
<li><a href="6.2-use-the-model-results.html#use-the-model-results"><span class="toc-section-number">6.2</span> Use the Model Results</a></li>
<li><a href="6.3-parsnip-predictions.html#parsnip-predictions"><span class="toc-section-number">6.3</span> Make Predictions</a></li>
<li><a href="6.4-parsnip-extension-packages.html#parsnip-extension-packages"><span class="toc-section-number">6.4</span> parsnip-Extension Packages</a></li>
<li><a href="6.5-parsnip-addin.html#parsnip-addin"><span class="toc-section-number">6.5</span> Creating Model Specifications</a></li>
<li><a href="6.6-models-summary.html#models-summary"><span class="toc-section-number">6.6</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="7-workflows.html#workflows"><span class="toc-section-number">7</span> A Model Workflow</a>
<ul>
<li><a href="7.1-begin-model-end.html#begin-model-end"><span class="toc-section-number">7.1</span> Where Does the Model Begin and End?</a></li>
<li><a href="7.2-workflow-basics.html#workflow-basics"><span class="toc-section-number">7.2</span> Workflow Basics</a></li>
<li><a href="7.3-adding-raw-variables-to-the-workflow.html#adding-raw-variables-to-the-workflow"><span class="toc-section-number">7.3</span> Adding Raw Variables to the <code>workflow()</code></a></li>
<li class="has-sub"><a href="7.4-workflow-encoding.html#workflow-encoding"><span class="toc-section-number">7.4</span> How Does a <code>workflow()</code> Use the Formula?</a>
<ul>
<li><a href="7.4-workflow-encoding.html#tree-based-models">Tree-based models</a></li>
<li><a href="7.4-workflow-encoding.html#special-model-formulas"><span class="toc-section-number">7.4.1</span> Special formulas and in-line functions</a></li>
</ul></li>
<li><a href="7.5-workflow-sets-intro.html#workflow-sets-intro"><span class="toc-section-number">7.5</span> Creating Multiple Workflows at Once</a></li>
<li><a href="7.6-evaluating-the-test-set.html#evaluating-the-test-set"><span class="toc-section-number">7.6</span> Evaluating the Test Set</a></li>
<li><a href="7.7-workflows-summary.html#workflows-summary"><span class="toc-section-number">7.7</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="8-recipes.html#recipes"><span class="toc-section-number">8</span> Feature Engineering with recipes</a>
<ul>
<li><a href="8.1-a-simple-recipe-for-the-ames-housing-data.html#a-simple-recipe-for-the-ames-housing-data"><span class="toc-section-number">8.1</span> A Simple <code>recipe()</code> for the Ames Housing Data</a></li>
<li><a href="8.2-using-recipes.html#using-recipes"><span class="toc-section-number">8.2</span> Using Recipes</a></li>
<li><a href="8.3-how-data-are-used-by-the-recipe.html#how-data-are-used-by-the-recipe"><span class="toc-section-number">8.3</span> How Data are Used by the <code>recipe()</code></a></li>
<li class="has-sub"><a href="8.4-example-steps.html#example-steps"><span class="toc-section-number">8.4</span> Examples of <code>recipe()</code> Steps</a>
<ul>
<li><a href="8.4-example-steps.html#dummies"><span class="toc-section-number">8.4.1</span> Encoding qualitative data in a numeric format</a></li>
<li><a href="8.4-example-steps.html#interaction-terms"><span class="toc-section-number">8.4.2</span> Interaction terms</a></li>
<li><a href="8.4-example-steps.html#spline-functions"><span class="toc-section-number">8.4.3</span> Spline functions</a></li>
<li><a href="8.4-example-steps.html#feature-extraction"><span class="toc-section-number">8.4.4</span> Feature extraction</a></li>
<li><a href="8.4-example-steps.html#row-sampling-steps"><span class="toc-section-number">8.4.5</span> Row sampling steps</a></li>
<li><a href="8.4-example-steps.html#general-transformations"><span class="toc-section-number">8.4.6</span> General transformations</a></li>
<li><a href="8.4-example-steps.html#natural-language-processing"><span class="toc-section-number">8.4.7</span> Natural language processing</a></li>
</ul></li>
<li><a href="8.5-skip-equals-true.html#skip-equals-true"><span class="toc-section-number">8.5</span> Skipping Steps for New Data</a></li>
<li><a href="8.6-tidy-a-recipe.html#tidy-a-recipe"><span class="toc-section-number">8.6</span> Tidy a <code>recipe()</code></a></li>
<li><a href="8.7-column-roles.html#column-roles"><span class="toc-section-number">8.7</span> Column Roles</a></li>
<li><a href="8.8-recipes-summary.html#recipes-summary"><span class="toc-section-number">8.8</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="9-performance.html#performance"><span class="toc-section-number">9</span> Judging Model Effectiveness</a>
<ul>
<li><a href="9.1-performance-metrics-and-inference.html#performance-metrics-and-inference"><span class="toc-section-number">9.1</span> Performance Metrics and Inference</a></li>
<li><a href="9.2-regression-metrics.html#regression-metrics"><span class="toc-section-number">9.2</span> Regression Metrics</a></li>
<li><a href="9.3-binary-classification-metrics.html#binary-classification-metrics"><span class="toc-section-number">9.3</span> Binary Classification Metrics</a></li>
<li><a href="9.4-multi-class-classification-metrics.html#multi-class-classification-metrics"><span class="toc-section-number">9.4</span> Multi-Class Classification Metrics</a></li>
<li><a href="9.5-performance-summary.html#performance-summary"><span class="toc-section-number">9.5</span> Chapter Summary</a></li>
</ul></li>
<li class="part"><span><b>Tools for Creating Effective Models</b></span></li>
<li class="has-sub"><a href="10-resampling.html#resampling"><span class="toc-section-number">10</span> Resampling for Evaluating Performance</a>
<ul>
<li><a href="10.1-resampling-resubstition.html#resampling-resubstition"><span class="toc-section-number">10.1</span> The Resubstitution Approach</a></li>
<li class="has-sub"><a href="10.2-resampling-methods.html#resampling-methods"><span class="toc-section-number">10.2</span> Resampling Methods</a>
<ul>
<li><a href="10.2-resampling-methods.html#cv"><span class="toc-section-number">10.2.1</span> Cross-validation</a></li>
<li><a href="10.2-resampling-methods.html#repeated-cross-validation">Repeated cross-validation</a></li>
<li><a href="10.2-resampling-methods.html#leave-one-out-cross-validation">Leave-one-out cross-validation</a></li>
<li><a href="10.2-resampling-methods.html#monte-carlo-cross-validation">Monte Carlo cross-validation</a></li>
<li><a href="10.2-resampling-methods.html#validation"><span class="toc-section-number">10.2.2</span> Validation sets</a></li>
<li><a href="10.2-resampling-methods.html#bootstrap"><span class="toc-section-number">10.2.3</span> Bootstrapping</a></li>
<li><a href="10.2-resampling-methods.html#rolling"><span class="toc-section-number">10.2.4</span> Rolling forecasting origin resampling</a></li>
</ul></li>
<li><a href="10.3-resampling-performance.html#resampling-performance"><span class="toc-section-number">10.3</span> Estimating Performance</a></li>
<li><a href="10.4-parallel.html#parallel"><span class="toc-section-number">10.4</span> Parallel Processing</a></li>
<li><a href="10.5-extract.html#extract"><span class="toc-section-number">10.5</span> Saving the Resampled Objects</a></li>
<li><a href="10.6-resampling-summary.html#resampling-summary"><span class="toc-section-number">10.6</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="11-compare.html#compare"><span class="toc-section-number">11</span> Comparing Models with Resampling</a>
<ul>
<li><a href="11.1-workflow-set.html#workflow-set"><span class="toc-section-number">11.1</span> Creating Multiple Models with Workflow Sets</a></li>
<li><a href="11.2-resampled-stats.html#resampled-stats"><span class="toc-section-number">11.2</span> Comparing Resampled Performance Statistics</a></li>
<li><a href="11.3-simple-hypothesis-testing-methods.html#simple-hypothesis-testing-methods"><span class="toc-section-number">11.3</span> Simple Hypothesis Testing Methods</a></li>
<li class="has-sub"><a href="11.4-tidyposterior.html#tidyposterior"><span class="toc-section-number">11.4</span> Bayesian Methods</a>
<ul>
<li><a href="11.4-tidyposterior.html#the-effect-of-the-amount-of-resampling">The effect of the amount of resampling</a></li>
</ul></li>
<li><a href="11.5-compare-summary.html#compare-summary"><span class="toc-section-number">11.5</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="12-tuning.html#tuning"><span class="toc-section-number">12</span> Model Tuning and the Dangers of Overfitting</a>
<ul>
<li><a href="12.1-model-parameters.html#model-parameters"><span class="toc-section-number">12.1</span> Model Parameters</a></li>
<li><a href="12.2-tuning-parameter-examples.html#tuning-parameter-examples"><span class="toc-section-number">12.2</span> Tuning Parameters for Different Types of Models</a></li>
<li><a href="12.3-what-to-optimize.html#what-to-optimize"><span class="toc-section-number">12.3</span> What do we Optimize?</a></li>
<li><a href="12.4-overfitting-bad.html#overfitting-bad"><span class="toc-section-number">12.4</span> The consequences of poor parameter estimates</a></li>
<li><a href="12.5-two-general-strategies-for-optimization.html#two-general-strategies-for-optimization"><span class="toc-section-number">12.5</span> Two general strategies for optimization</a></li>
<li><a href="12.6-tuning-params-tidymodels.html#tuning-params-tidymodels"><span class="toc-section-number">12.6</span> Tuning Parameters in tidymodels</a></li>
<li><a href="12.7-chapter-summary-2.html#chapter-summary-2"><span class="toc-section-number">12.7</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="13-grid-search.html#grid-search"><span class="toc-section-number">13</span> Grid Search</a>
<ul>
<li class="has-sub"><a href="13.1-grids.html#grids"><span class="toc-section-number">13.1</span> Regular and Non-Regular Grids</a>
<ul>
<li><a href="13.1-grids.html#regular-grids">Regular grids</a></li>
<li><a href="13.1-grids.html#irregular-grids">Irregular grids</a></li>
</ul></li>
<li><a href="13.2-evaluating-grid.html#evaluating-grid"><span class="toc-section-number">13.2</span> Evaluating the Grid</a></li>
<li><a href="13.3-finalizing-the-model.html#finalizing-the-model"><span class="toc-section-number">13.3</span> Finalizing the Model</a></li>
<li><a href="13.4-tuning-usemodels.html#tuning-usemodels"><span class="toc-section-number">13.4</span> Tools for Creating Tuning Specifications</a></li>
<li class="has-sub"><a href="13.5-efficient-grids.html#efficient-grids"><span class="toc-section-number">13.5</span> Tools for Efficient Grid Search</a>
<ul>
<li><a href="13.5-efficient-grids.html#submodel-trick"><span class="toc-section-number">13.5.1</span> Submodel optimization</a></li>
<li><a href="13.5-efficient-grids.html#parallel-processing"><span class="toc-section-number">13.5.2</span> Parallel processing</a></li>
<li><a href="13.5-efficient-grids.html#benchmarking-boosted-trees"><span class="toc-section-number">13.5.3</span> Benchmarking boosted trees</a></li>
<li><a href="13.5-efficient-grids.html#access-to-global-variables"><span class="toc-section-number">13.5.4</span> Access to global variables</a></li>
<li><a href="13.5-efficient-grids.html#racing"><span class="toc-section-number">13.5.5</span> Racing methods</a></li>
</ul></li>
<li><a href="13.6-grid-summary.html#grid-summary"><span class="toc-section-number">13.6</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="14-iterative-search.html#iterative-search"><span class="toc-section-number">14</span> Iterative Search</a>
<ul>
<li><a href="14.1-svm.html#svm"><span class="toc-section-number">14.1</span> A Support Vector Machine Model</a></li>
<li class="has-sub"><a href="14.2-bayesian-optimization.html#bayesian-optimization"><span class="toc-section-number">14.2</span> Bayesian Optimization</a>
<ul>
<li><a href="14.2-bayesian-optimization.html#a-gaussian-process-model"><span class="toc-section-number">14.2.1</span> A Gaussian process model</a></li>
<li><a href="14.2-bayesian-optimization.html#acquisition-functions"><span class="toc-section-number">14.2.2</span> Acquisition functions</a></li>
<li><a href="14.2-bayesian-optimization.html#tune-bayes"><span class="toc-section-number">14.2.3</span> The <code>tune_bayes()</code> function</a></li>
</ul></li>
<li class="has-sub"><a href="14.3-simulated-annealing.html#simulated-annealing"><span class="toc-section-number">14.3</span> Simulated Annealing</a>
<ul>
<li><a href="14.3-simulated-annealing.html#simulated-annealing-search-process"><span class="toc-section-number">14.3.1</span> Simulated annealing search process</a></li>
<li><a href="14.3-simulated-annealing.html#tune-sim-anneal"><span class="toc-section-number">14.3.2</span> The <code>tune_sim_anneal()</code> function</a></li>
</ul></li>
<li><a href="14.4-iterative-summary.html#iterative-summary"><span class="toc-section-number">14.4</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="15-workflow-sets.html#workflow-sets"><span class="toc-section-number">15</span> Screening Many Models</a>
<ul>
<li><a href="15.1-modeling-concrete-mixture-strength.html#modeling-concrete-mixture-strength"><span class="toc-section-number">15.1</span> Modeling Concrete Mixture Strength</a></li>
<li><a href="15.2-creating-the-workflow-set.html#creating-the-workflow-set"><span class="toc-section-number">15.2</span> Creating the Workflow Set</a></li>
<li><a href="15.3-tuning-and-evaluating-the-models.html#tuning-and-evaluating-the-models"><span class="toc-section-number">15.3</span> Tuning and Evaluating the Models</a></li>
<li><a href="15.4-racing-example.html#racing-example"><span class="toc-section-number">15.4</span> Efficiently Screening Models</a></li>
<li><a href="15.5-finalizing-a-model.html#finalizing-a-model"><span class="toc-section-number">15.5</span> Finalizing a Model</a></li>
<li><a href="15.6-workflow-sets-summary.html#workflow-sets-summary"><span class="toc-section-number">15.6</span> Chapter Summary</a></li>
</ul></li>
<li class="part"><span><b>Beyond the Basics</b></span></li>
<li class="has-sub"><a href="16-dimensionality.html#dimensionality"><span class="toc-section-number">16</span> Dimensionality Reduction</a>
<ul>
<li><a href="16.1-when-problems-can-dimensionality-reduction-solve.html#when-problems-can-dimensionality-reduction-solve"><span class="toc-section-number">16.1</span> When Problems Can Dimensionality Reduction Solve?</a></li>
<li><a href="16.2-beans.html#beans"><span class="toc-section-number">16.2</span> A Picture is Worth a Thousand… Beans</a></li>
<li><a href="16.3-a-starter-recipe.html#a-starter-recipe"><span class="toc-section-number">16.3</span> A Starter Recipe</a></li>
<li class="has-sub"><a href="16.4-recipe-functions.html#recipe-functions"><span class="toc-section-number">16.4</span> Recipes in the Wild</a>
<ul>
<li><a href="16.4-recipe-functions.html#prep"><span class="toc-section-number">16.4.1</span> Preparing a recipe</a></li>
<li><a href="16.4-recipe-functions.html#bake"><span class="toc-section-number">16.4.2</span> Baking the recipe</a></li>
</ul></li>
<li class="has-sub"><a href="16.5-feature-extraction-techniques.html#feature-extraction-techniques"><span class="toc-section-number">16.5</span> Feature Extraction Techniques</a>
<ul>
<li><a href="16.5-feature-extraction-techniques.html#principal-component-analysis"><span class="toc-section-number">16.5.1</span> Principal component analysis</a></li>
<li><a href="16.5-feature-extraction-techniques.html#partial-least-squares"><span class="toc-section-number">16.5.2</span> Partial least squares</a></li>
<li><a href="16.5-feature-extraction-techniques.html#independent-component-analysis"><span class="toc-section-number">16.5.3</span> Independent component analysis</a></li>
<li><a href="16.5-feature-extraction-techniques.html#uniform-manifold-approximation-and-projection"><span class="toc-section-number">16.5.4</span> Uniform manifold approximation and projection</a></li>
</ul></li>
<li><a href="16.6-bean-models.html#bean-models"><span class="toc-section-number">16.6</span> Modeling</a></li>
<li><a href="16.7-dimensionality-summary.html#dimensionality-summary"><span class="toc-section-number">16.7</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="17-categorical.html#categorical"><span class="toc-section-number">17</span> Encoding Categorical Data</a>
<ul>
<li><a href="17.1-is-an-encoding-necessary.html#is-an-encoding-necessary"><span class="toc-section-number">17.1</span> Is an Encoding Necessary?</a></li>
<li><a href="17.2-encoding-ordinal-predictors.html#encoding-ordinal-predictors"><span class="toc-section-number">17.2</span> Encoding Ordinal Predictors</a></li>
<li class="has-sub"><a href="17.3-using-the-outcome-for-encoding-predictors.html#using-the-outcome-for-encoding-predictors"><span class="toc-section-number">17.3</span> Using the Outcome for Encoding Predictors</a>
<ul>
<li><a href="17.3-using-the-outcome-for-encoding-predictors.html#effect-encodings-with-partial-pooling"><span class="toc-section-number">17.3.1</span> Effect encodings with partial pooling</a></li>
</ul></li>
<li><a href="17.4-feature-hashing.html#feature-hashing"><span class="toc-section-number">17.4</span> Feature Hashing</a></li>
<li><a href="17.5-more-encoding-options.html#more-encoding-options"><span class="toc-section-number">17.5</span> More Encoding Options</a></li>
<li><a href="17.6-categorical-summary.html#categorical-summary"><span class="toc-section-number">17.6</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="18-explain.html#explain"><span class="toc-section-number">18</span> Explaining Models and Predictions</a>
<ul>
<li><a href="18.1-software-for-model-explanations.html#software-for-model-explanations"><span class="toc-section-number">18.1</span> Software for Model Explanations</a></li>
<li><a href="18.2-local-explanations.html#local-explanations"><span class="toc-section-number">18.2</span> Local Explanations</a></li>
<li><a href="18.3-global-explanations.html#global-explanations"><span class="toc-section-number">18.3</span> Global Explanations</a></li>
<li><a href="18.4-building-global-explanations-from-local-explanations.html#building-global-explanations-from-local-explanations"><span class="toc-section-number">18.4</span> Building Global Explanations from Local Explanations</a></li>
<li><a href="18.5-back-to-beans.html#back-to-beans"><span class="toc-section-number">18.5</span> Back to Beans!</a></li>
<li><a href="18.6-explain-summary.html#explain-summary"><span class="toc-section-number">18.6</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="19-trust.html#trust"><span class="toc-section-number">19</span> When Should You Trust Your Predictions?</a>
<ul>
<li><a href="19.1-equivocal-zones.html#equivocal-zones"><span class="toc-section-number">19.1</span> Equivocal Results</a></li>
<li><a href="19.2-applicability-domains.html#applicability-domains"><span class="toc-section-number">19.2</span> Determining Model Applicability</a></li>
<li><a href="19.3-trust-summary.html#trust-summary"><span class="toc-section-number">19.3</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="20-ensembles.html#ensembles"><span class="toc-section-number">20</span> Ensembles of Models</a>
<ul>
<li><a href="20.1-data-stack.html#data-stack"><span class="toc-section-number">20.1</span> Creating the Training Set for Stacking</a></li>
<li><a href="20.2-blend-predictions.html#blend-predictions"><span class="toc-section-number">20.2</span> Blend the Predictions</a></li>
<li><a href="20.3-fit-members.html#fit-members"><span class="toc-section-number">20.3</span> Fit the Member Models</a></li>
<li><a href="20.4-test-set-results.html#test-set-results"><span class="toc-section-number">20.4</span> Test Set Results</a></li>
<li><a href="20.5-ensembles-summary.html#ensembles-summary"><span class="toc-section-number">20.5</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="21-inferential.html#inferential"><span class="toc-section-number">21</span> Inferential Analysis</a>
<ul>
<li><a href="21.1-inference-for-count-data.html#inference-for-count-data"><span class="toc-section-number">21.1</span> Inference for Count Data</a></li>
<li><a href="21.2-comparisons-with-two-sample-tests.html#comparisons-with-two-sample-tests"><span class="toc-section-number">21.2</span> Comparisons with Two-Sample Tests</a></li>
<li><a href="21.3-log-linear-models.html#log-linear-models"><span class="toc-section-number">21.3</span> Log-Linear Models</a></li>
<li><a href="21.4-a-more-complex-model.html#a-more-complex-model"><span class="toc-section-number">21.4</span> A More Complex Model</a></li>
<li><a href="21.5-inference-options.html#inference-options"><span class="toc-section-number">21.5</span> More Inferential Analysis</a></li>
<li><a href="21.6-inference-summary.html#inference-summary"><span class="toc-section-number">21.6</span> Chapter Summary</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li><a href="A-pre-proc-table.html#pre-proc-table"><span class="toc-section-number">A</span> Recommended Preprocessing</a></li>
<li><a href="references.html#references">REFERENCES</a></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="multi-class-classification-metrics" class="section level2" number="9.4">
<h2><span class="header-section-number">9.4</span> Multi-Class Classification Metrics</h2>
<p>What about data with three or more classes? To demonstrate, let’s explore a different example data set that has four classes:</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="9.4-multi-class-classification-metrics.html#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(hpc_cv)</span>
<span id="cb125-2"><a href="9.4-multi-class-classification-metrics.html#cb125-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(hpc_cv)</span>
<span id="cb125-3"><a href="9.4-multi-class-classification-metrics.html#cb125-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3,467 × 7</span></span>
<span id="cb125-4"><a href="9.4-multi-class-classification-metrics.html#cb125-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   obs   pred     VF      F       M          L Resample</span></span>
<span id="cb125-5"><a href="9.4-multi-class-classification-metrics.html#cb125-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;   </span></span>
<span id="cb125-6"><a href="9.4-multi-class-classification-metrics.html#cb125-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 VF    VF    0.914 0.0779 0.00848 0.0000199  Fold01  </span></span>
<span id="cb125-7"><a href="9.4-multi-class-classification-metrics.html#cb125-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 VF    VF    0.938 0.0571 0.00482 0.0000101  Fold01  </span></span>
<span id="cb125-8"><a href="9.4-multi-class-classification-metrics.html#cb125-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 VF    VF    0.947 0.0495 0.00316 0.00000500 Fold01  </span></span>
<span id="cb125-9"><a href="9.4-multi-class-classification-metrics.html#cb125-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 VF    VF    0.929 0.0653 0.00579 0.0000156  Fold01  </span></span>
<span id="cb125-10"><a href="9.4-multi-class-classification-metrics.html#cb125-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 VF    VF    0.942 0.0543 0.00381 0.00000729 Fold01  </span></span>
<span id="cb125-11"><a href="9.4-multi-class-classification-metrics.html#cb125-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 VF    VF    0.951 0.0462 0.00272 0.00000384 Fold01  </span></span>
<span id="cb125-12"><a href="9.4-multi-class-classification-metrics.html#cb125-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 3,461 more rows</span></span></code></pre></div>
<p>As before, there are factors for the observed and predicted outcomes along with four other columns of predicted probabilities for each class. (These data also include a <code>Resample</code> column. These <code>hpc_cv</code> results are for out-of-sample predictions associated with 10-fold cross-validation. For the time being, this column will be ignored and we’ll discuss resampling in depth in Chapter <a href="10-resampling.html#resampling">10</a>.)</p>
<p>The functions for metrics that use the discrete class predictions are identical to their binary counterparts:</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="9.4-multi-class-classification-metrics.html#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(hpc_cv, obs, pred)</span>
<span id="cb126-2"><a href="9.4-multi-class-classification-metrics.html#cb126-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 3</span></span>
<span id="cb126-3"><a href="9.4-multi-class-classification-metrics.html#cb126-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .metric  .estimator .estimate</span></span>
<span id="cb126-4"><a href="9.4-multi-class-classification-metrics.html#cb126-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span id="cb126-5"><a href="9.4-multi-class-classification-metrics.html#cb126-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 accuracy multiclass     0.709</span></span>
<span id="cb126-6"><a href="9.4-multi-class-classification-metrics.html#cb126-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-7"><a href="9.4-multi-class-classification-metrics.html#cb126-7" aria-hidden="true" tabindex="-1"></a><span class="fu">mcc</span>(hpc_cv, obs, pred)</span>
<span id="cb126-8"><a href="9.4-multi-class-classification-metrics.html#cb126-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 3</span></span>
<span id="cb126-9"><a href="9.4-multi-class-classification-metrics.html#cb126-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .metric .estimator .estimate</span></span>
<span id="cb126-10"><a href="9.4-multi-class-classification-metrics.html#cb126-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span id="cb126-11"><a href="9.4-multi-class-classification-metrics.html#cb126-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 mcc     multiclass     0.515</span></span></code></pre></div>
<p>Note that, in these results, a “multiclass” <code>.estimator</code> is listed. Like “binary”, this indicates that the formula for outcomes with three or more class levels was used. The Matthews correlation coefficient was originally designed for two classes but has been extended to cases with more class levels.</p>
<p>There are methods for taking metrics designed to handle outcomes with only two classes and extend them for outcomes with more than two classes. For example, a metric such as sensitivity measures the true positive rate which, by definition, is specific to two classes (i.e., “event” and “non-event”). How can this metric be used in our example data?</p>
<p>There are wrapper methods that can be used to apply sensitivity to our four-class outcome. These options are macro-averaging, macro-weighted averaging, and micro-averaging:</p>
<ul>
<li><p>Macro-averaging computes a set of one-versus-all metrics using the standard two-class statistics. These are averaged.</p></li>
<li><p>Macro-weighted averaging does the same but the average is weighted by the number of samples in each class.</p></li>
<li><p>Micro-averaging computes the contribution for each class, aggregates them, then computes a single metric from the aggregates.</p></li>
</ul>
<p>See <span class="citation">Wu and Zhou (<a href="#ref-wu2017unified" role="doc-biblioref">2017</a>)</span> and <span class="citation">Opitz and Burst (<a href="#ref-OpitzBurst" role="doc-biblioref">2019</a>)</span> for more on extending classification metrics to outcomes with more than two classes.</p>
<p>Using sensitivity as an example, the usual two-class calculation is the ratio of the number of correctly predicted events divided by the number of true events. The “manual” calculations for these averaging methods are:</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="9.4-multi-class-classification-metrics.html#cb127-1" aria-hidden="true" tabindex="-1"></a>class_totals <span class="ot">&lt;-</span> </span>
<span id="cb127-2"><a href="9.4-multi-class-classification-metrics.html#cb127-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(hpc_cv, obs, <span class="at">name =</span> <span class="st">&quot;totals&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb127-3"><a href="9.4-multi-class-classification-metrics.html#cb127-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">class_wts =</span> totals <span class="sc">/</span> <span class="fu">sum</span>(totals))</span>
<span id="cb127-4"><a href="9.4-multi-class-classification-metrics.html#cb127-4" aria-hidden="true" tabindex="-1"></a>class_totals</span>
<span id="cb127-5"><a href="9.4-multi-class-classification-metrics.html#cb127-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   obs totals class_wts</span></span>
<span id="cb127-6"><a href="9.4-multi-class-classification-metrics.html#cb127-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  VF   1769   0.51024</span></span>
<span id="cb127-7"><a href="9.4-multi-class-classification-metrics.html#cb127-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2   F   1078   0.31093</span></span>
<span id="cb127-8"><a href="9.4-multi-class-classification-metrics.html#cb127-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3   M    412   0.11883</span></span>
<span id="cb127-9"><a href="9.4-multi-class-classification-metrics.html#cb127-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4   L    208   0.05999</span></span>
<span id="cb127-10"><a href="9.4-multi-class-classification-metrics.html#cb127-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-11"><a href="9.4-multi-class-classification-metrics.html#cb127-11" aria-hidden="true" tabindex="-1"></a>cell_counts <span class="ot">&lt;-</span> </span>
<span id="cb127-12"><a href="9.4-multi-class-classification-metrics.html#cb127-12" aria-hidden="true" tabindex="-1"></a>  hpc_cv <span class="sc">%&gt;%</span> </span>
<span id="cb127-13"><a href="9.4-multi-class-classification-metrics.html#cb127-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(obs, pred) <span class="sc">%&gt;%</span> </span>
<span id="cb127-14"><a href="9.4-multi-class-classification-metrics.html#cb127-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb127-15"><a href="9.4-multi-class-classification-metrics.html#cb127-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb127-16"><a href="9.4-multi-class-classification-metrics.html#cb127-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-17"><a href="9.4-multi-class-classification-metrics.html#cb127-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the four sensitivities using 1-vs-all</span></span>
<span id="cb127-18"><a href="9.4-multi-class-classification-metrics.html#cb127-18" aria-hidden="true" tabindex="-1"></a>one_versus_all <span class="ot">&lt;-</span> </span>
<span id="cb127-19"><a href="9.4-multi-class-classification-metrics.html#cb127-19" aria-hidden="true" tabindex="-1"></a>  cell_counts <span class="sc">%&gt;%</span> </span>
<span id="cb127-20"><a href="9.4-multi-class-classification-metrics.html#cb127-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(obs <span class="sc">==</span> pred) <span class="sc">%&gt;%</span> </span>
<span id="cb127-21"><a href="9.4-multi-class-classification-metrics.html#cb127-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(class_totals, <span class="at">by =</span> <span class="st">&quot;obs&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb127-22"><a href="9.4-multi-class-classification-metrics.html#cb127-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sens =</span> n <span class="sc">/</span> totals)</span>
<span id="cb127-23"><a href="9.4-multi-class-classification-metrics.html#cb127-23" aria-hidden="true" tabindex="-1"></a>one_versus_all</span>
<span id="cb127-24"><a href="9.4-multi-class-classification-metrics.html#cb127-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 4 × 6</span></span>
<span id="cb127-25"><a href="9.4-multi-class-classification-metrics.html#cb127-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   obs   pred      n totals class_wts  sens</span></span>
<span id="cb127-26"><a href="9.4-multi-class-classification-metrics.html#cb127-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;fct&gt; &lt;fct&gt; &lt;int&gt;  &lt;int&gt;     &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb127-27"><a href="9.4-multi-class-classification-metrics.html#cb127-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 VF    VF     1620   1769    0.510  0.916</span></span>
<span id="cb127-28"><a href="9.4-multi-class-classification-metrics.html#cb127-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 F     F       647   1078    0.311  0.600</span></span>
<span id="cb127-29"><a href="9.4-multi-class-classification-metrics.html#cb127-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 M     M        79    412    0.119  0.192</span></span>
<span id="cb127-30"><a href="9.4-multi-class-classification-metrics.html#cb127-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 L     L       111    208    0.0600 0.534</span></span>
<span id="cb127-31"><a href="9.4-multi-class-classification-metrics.html#cb127-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-32"><a href="9.4-multi-class-classification-metrics.html#cb127-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Three different estimates:</span></span>
<span id="cb127-33"><a href="9.4-multi-class-classification-metrics.html#cb127-33" aria-hidden="true" tabindex="-1"></a>one_versus_all <span class="sc">%&gt;%</span> </span>
<span id="cb127-34"><a href="9.4-multi-class-classification-metrics.html#cb127-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb127-35"><a href="9.4-multi-class-classification-metrics.html#cb127-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">macro =</span> <span class="fu">mean</span>(sens), </span>
<span id="cb127-36"><a href="9.4-multi-class-classification-metrics.html#cb127-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">macro_wts =</span> <span class="fu">weighted.mean</span>(sens, class_wts),</span>
<span id="cb127-37"><a href="9.4-multi-class-classification-metrics.html#cb127-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">micro =</span> <span class="fu">sum</span>(n) <span class="sc">/</span> <span class="fu">sum</span>(totals)</span>
<span id="cb127-38"><a href="9.4-multi-class-classification-metrics.html#cb127-38" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb127-39"><a href="9.4-multi-class-classification-metrics.html#cb127-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 3</span></span>
<span id="cb127-40"><a href="9.4-multi-class-classification-metrics.html#cb127-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   macro macro_wts micro</span></span>
<span id="cb127-41"><a href="9.4-multi-class-classification-metrics.html#cb127-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb127-42"><a href="9.4-multi-class-classification-metrics.html#cb127-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 0.560     0.709 0.709</span></span></code></pre></div>
<p>Thankfully, there is no need to manually implement these averaging methods. Instead, <span class="pkg">yardstick</span> functions can automatically apply these method via the <code>estimator</code> argument:</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="9.4-multi-class-classification-metrics.html#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sensitivity</span>(hpc_cv, obs, pred, <span class="at">estimator =</span> <span class="st">&quot;macro&quot;</span>)</span>
<span id="cb128-2"><a href="9.4-multi-class-classification-metrics.html#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 3</span></span>
<span id="cb128-3"><a href="9.4-multi-class-classification-metrics.html#cb128-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .metric     .estimator .estimate</span></span>
<span id="cb128-4"><a href="9.4-multi-class-classification-metrics.html#cb128-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span id="cb128-5"><a href="9.4-multi-class-classification-metrics.html#cb128-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 sensitivity macro          0.560</span></span>
<span id="cb128-6"><a href="9.4-multi-class-classification-metrics.html#cb128-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sensitivity</span>(hpc_cv, obs, pred, <span class="at">estimator =</span> <span class="st">&quot;macro_weighted&quot;</span>)</span>
<span id="cb128-7"><a href="9.4-multi-class-classification-metrics.html#cb128-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 3</span></span>
<span id="cb128-8"><a href="9.4-multi-class-classification-metrics.html#cb128-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .metric     .estimator     .estimate</span></span>
<span id="cb128-9"><a href="9.4-multi-class-classification-metrics.html#cb128-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;              &lt;dbl&gt;</span></span>
<span id="cb128-10"><a href="9.4-multi-class-classification-metrics.html#cb128-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 sensitivity macro_weighted     0.709</span></span>
<span id="cb128-11"><a href="9.4-multi-class-classification-metrics.html#cb128-11" aria-hidden="true" tabindex="-1"></a><span class="fu">sensitivity</span>(hpc_cv, obs, pred, <span class="at">estimator =</span> <span class="st">&quot;micro&quot;</span>)</span>
<span id="cb128-12"><a href="9.4-multi-class-classification-metrics.html#cb128-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 3</span></span>
<span id="cb128-13"><a href="9.4-multi-class-classification-metrics.html#cb128-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .metric     .estimator .estimate</span></span>
<span id="cb128-14"><a href="9.4-multi-class-classification-metrics.html#cb128-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span id="cb128-15"><a href="9.4-multi-class-classification-metrics.html#cb128-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 sensitivity micro          0.709</span></span></code></pre></div>
<p>When dealing with probability estimates, there are some metrics with multi-class analogs. For example, <span class="citation">Hand and Till (<a href="#ref-HandTill" role="doc-biblioref">2001</a>)</span> determined a multi-class technique for ROC curves. In this case, <em>all</em> of the class probability columns must be given to the function:</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="9.4-multi-class-classification-metrics.html#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">roc_auc</span>(hpc_cv, obs, VF, F, M, L)</span>
<span id="cb129-2"><a href="9.4-multi-class-classification-metrics.html#cb129-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 3</span></span>
<span id="cb129-3"><a href="9.4-multi-class-classification-metrics.html#cb129-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .metric .estimator .estimate</span></span>
<span id="cb129-4"><a href="9.4-multi-class-classification-metrics.html#cb129-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span id="cb129-5"><a href="9.4-multi-class-classification-metrics.html#cb129-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 roc_auc hand_till      0.829</span></span></code></pre></div>
<p>Macro-weighted averaging is also available as an option for applying this metric to a multi-class outcome:</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="9.4-multi-class-classification-metrics.html#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">roc_auc</span>(hpc_cv, obs, VF, F, M, L, <span class="at">estimator =</span> <span class="st">&quot;macro_weighted&quot;</span>)</span>
<span id="cb130-2"><a href="9.4-multi-class-classification-metrics.html#cb130-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 3</span></span>
<span id="cb130-3"><a href="9.4-multi-class-classification-metrics.html#cb130-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .metric .estimator     .estimate</span></span>
<span id="cb130-4"><a href="9.4-multi-class-classification-metrics.html#cb130-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;              &lt;dbl&gt;</span></span>
<span id="cb130-5"><a href="9.4-multi-class-classification-metrics.html#cb130-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 roc_auc macro_weighted     0.868</span></span></code></pre></div>
<p>Finally, all of these performance metrics can be computed using <span class="pkg">dplyr</span> groupings. Recall that these data have a column for the resampling groups. We haven’t yet discussed resampling in detail, but notice how we can pass a grouped data frame to the metric function to compute the metrics for each group:</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="9.4-multi-class-classification-metrics.html#cb131-1" aria-hidden="true" tabindex="-1"></a>hpc_cv <span class="sc">%&gt;%</span> </span>
<span id="cb131-2"><a href="9.4-multi-class-classification-metrics.html#cb131-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Resample) <span class="sc">%&gt;%</span> </span>
<span id="cb131-3"><a href="9.4-multi-class-classification-metrics.html#cb131-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">accuracy</span>(obs, pred)</span>
<span id="cb131-4"><a href="9.4-multi-class-classification-metrics.html#cb131-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 10 × 4</span></span>
<span id="cb131-5"><a href="9.4-multi-class-classification-metrics.html#cb131-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Resample .metric  .estimator .estimate</span></span>
<span id="cb131-6"><a href="9.4-multi-class-classification-metrics.html#cb131-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span id="cb131-7"><a href="9.4-multi-class-classification-metrics.html#cb131-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Fold01   accuracy multiclass     0.726</span></span>
<span id="cb131-8"><a href="9.4-multi-class-classification-metrics.html#cb131-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Fold02   accuracy multiclass     0.712</span></span>
<span id="cb131-9"><a href="9.4-multi-class-classification-metrics.html#cb131-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 Fold03   accuracy multiclass     0.758</span></span>
<span id="cb131-10"><a href="9.4-multi-class-classification-metrics.html#cb131-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 Fold04   accuracy multiclass     0.712</span></span>
<span id="cb131-11"><a href="9.4-multi-class-classification-metrics.html#cb131-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 Fold05   accuracy multiclass     0.712</span></span>
<span id="cb131-12"><a href="9.4-multi-class-classification-metrics.html#cb131-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 Fold06   accuracy multiclass     0.697</span></span>
<span id="cb131-13"><a href="9.4-multi-class-classification-metrics.html#cb131-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 4 more rows</span></span></code></pre></div>
<p>The groupings also translate to the <code>autoplot()</code> methods, with results in in Figure <a href="9.4-multi-class-classification-metrics.html#fig:grouped-roc-curves">9.4</a>.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="9.4-multi-class-classification-metrics.html#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Four 1-vs-all ROC curves for each fold</span></span>
<span id="cb132-2"><a href="9.4-multi-class-classification-metrics.html#cb132-2" aria-hidden="true" tabindex="-1"></a>hpc_cv <span class="sc">%&gt;%</span> </span>
<span id="cb132-3"><a href="9.4-multi-class-classification-metrics.html#cb132-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Resample) <span class="sc">%&gt;%</span> </span>
<span id="cb132-4"><a href="9.4-multi-class-classification-metrics.html#cb132-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">roc_curve</span>(obs, VF, F, M, L) <span class="sc">%&gt;%</span> </span>
<span id="cb132-5"><a href="9.4-multi-class-classification-metrics.html#cb132-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb132-6"><a href="9.4-multi-class-classification-metrics.html#cb132-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:grouped-roc-curves"></span>
<img src="figures/grouped-roc-curves-1.png" alt="Resampled ROC curves for each of the four outcome classes. There are four panels for classes VF, F, M, and L. Each panel contains ten ROC curves for each of the resampled data sets."  />
<p class="caption">
Figure 9.4: Resampled ROC curves for each of the four outcome classes.
</p>
</div>
<p>This visualization shows us that the different groups all perform about the same, but that the <code>VF</code> class is predicted better than the <code>F</code> or <code>M</code> classes, since the <code>VF</code> ROC curves are up in the top left corner more. This example uses resamples as the groups, but any grouping in your data can be used. This <code>autoplot()</code> method can be a quick visualization method for model effectiveness across outcome classes and/or groups.</p>
</div>
<h3>REFERENCES</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-HandTill" class="csl-entry">
Hand, D, and R Till. 2001. <span>“A Simple Generalisation of the Area Under the <span>ROC</span> Curve for Multiple Class Classification Problems.”</span> <em>Machine Learning</em> 45 (August): 171–86.
</div>
<div id="ref-OpitzBurst" class="csl-entry">
Opitz, J, and S Burst. 2019. <span>“Macro F1 and Macro F1.”</span> <a href="https://arxiv.org/abs/1911.03347">https://arxiv.org/abs/1911.03347</a>.
</div>
<div id="ref-wu2017unified" class="csl-entry">
Wu, X, and Z Zhou. 2017. <span>“A Unified View of Multi-Label Performance Measures.”</span> In <em>International Conference on Machine Learning</em>, 3780–88.
</div>
</div>
<p style="text-align: center;">
<a href="9.3-binary-classification-metrics.html"><button class="btn btn-default">Previous</button></a>
<a href="9.5-performance-summary.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

</body>
</html>
