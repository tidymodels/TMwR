<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="19.2 Determining Model Applicability | Tidy Modeling with R" />
<meta property="og:type" content="book" />
<meta property="og:image" content="/images/cover.png" />
<meta property="og:description" content="The tidymodels framework is a collection of R packages for modeling and machine learning using tidyverse principles. This book provides a thorough introduction to how to use tidymodels, and an outline of good methodology and statistical practice for phases of the modeling process." />
<meta name="github-repo" content="tidymodels/TMwR" />

<meta name="author" content="Max Kuhn and Julia Silge" />


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta name="description" content="The tidymodels framework is a collection of R packages for modeling and machine learning using tidyverse principles. This book provides a thorough introduction to how to use tidymodels, and an outline of good methodology and statistical practice for phases of the modeling process.">

<title>19.2 Determining Model Applicability | Tidy Modeling with R</title>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="libs/navigation-1.1/tabsets.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
/* show arrow before summary tag as in bootstrap
TODO: remove if boostrap in updated in html_document (rmarkdown#1485) */
details > summary {
  display: list-item;
  cursor: pointer;
}
</style>
</head>

<body>

<div class="container-fluid main-container">


<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li class="has-sub"><a href="index.html#hello-world">Hello World</a>
<ul>
<li><a href="acknowledgments.html#acknowledgments">Acknowledgments</a></li>
<li><a href="using-code-examples.html#using-code-examples">Using Code Examples</a></li>
</ul></li>
<li class="part"><span><b>Introduction</b></span></li>
<li class="has-sub"><a href="1-software-modeling.html#software-modeling"><span class="toc-section-number">1</span> Software for modeling</a>
<ul>
<li><a href="1.1-fundamentals-for-modeling-software.html#fundamentals-for-modeling-software"><span class="toc-section-number">1.1</span> Fundamentals for Modeling Software</a></li>
<li class="has-sub"><a href="1.2-model-types.html#model-types"><span class="toc-section-number">1.2</span> Types of Models</a>
<ul>
<li><a href="1.2-model-types.html#descriptive-models">Descriptive models</a></li>
<li><a href="1.2-model-types.html#inferential-models">Inferential models</a></li>
<li><a href="1.2-model-types.html#predictive-models">Predictive models</a></li>
</ul></li>
<li><a href="1.3-connections-between-types-of-models.html#connections-between-types-of-models"><span class="toc-section-number">1.3</span> Connections Between Types of Models</a></li>
<li><a href="1.4-model-terminology.html#model-terminology"><span class="toc-section-number">1.4</span> Some Terminology</a></li>
<li><a href="1.5-model-phases.html#model-phases"><span class="toc-section-number">1.5</span> How Does Modeling Fit into the Data Analysis Process?</a></li>
<li><a href="1.6-software-summary.html#software-summary"><span class="toc-section-number">1.6</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="2-tidyverse.html#tidyverse"><span class="toc-section-number">2</span> A Tidyverse Primer</a>
<ul>
<li class="has-sub"><a href="2.1-tidyverse-principles.html#tidyverse-principles"><span class="toc-section-number">2.1</span> Tidyverse Principles</a>
<ul>
<li><a href="2.1-tidyverse-principles.html#design-for-humans"><span class="toc-section-number">2.1.1</span> Design for humans</a></li>
<li><a href="2.1-tidyverse-principles.html#reuse-existing-data-structures"><span class="toc-section-number">2.1.2</span> Reuse existing data structures</a></li>
<li><a href="2.1-tidyverse-principles.html#design-for-the-pipe-and-functional-programming"><span class="toc-section-number">2.1.3</span> Design for the pipe and functional programming</a></li>
</ul></li>
<li><a href="2.2-examples-of-tidyverse-syntax.html#examples-of-tidyverse-syntax"><span class="toc-section-number">2.2</span> Examples of Tidyverse Syntax</a></li>
<li><a href="2.3-chapter-summary.html#chapter-summary"><span class="toc-section-number">2.3</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="3-base-r.html#base-r"><span class="toc-section-number">3</span> A Review of R Modeling Fundamentals</a>
<ul>
<li><a href="3.1-an-example.html#an-example"><span class="toc-section-number">3.1</span> An Example</a></li>
<li><a href="3.2-formula.html#formula"><span class="toc-section-number">3.2</span> What Does the R Formula Do?</a></li>
<li><a href="3.3-tidiness-modeling.html#tidiness-modeling"><span class="toc-section-number">3.3</span> Why Tidiness is Important for Modeling</a></li>
<li><a href="3.4-combining-base-r-models-and-the-tidyverse.html#combining-base-r-models-and-the-tidyverse"><span class="toc-section-number">3.4</span> Combining Base R Models and the Tidyverse</a></li>
<li><a href="3.5-the-tidymodels-metapackage.html#the-tidymodels-metapackage"><span class="toc-section-number">3.5</span> The tidymodels Metapackage</a></li>
<li><a href="3.6-chapter-summary-1.html#chapter-summary-1"><span class="toc-section-number">3.6</span> Chapter Summary</a></li>
</ul></li>
<li class="part"><span><b>Modeling Basics</b></span></li>
<li class="has-sub"><a href="4-ames.html#ames"><span class="toc-section-number">4</span> The Ames Housing Data</a>
<ul>
<li><a href="4.1-exploring-features-of-homes-in-ames.html#exploring-features-of-homes-in-ames"><span class="toc-section-number">4.1</span> Exploring Features of Homes in Ames</a></li>
<li><a href="4.2-ames-summary.html#ames-summary"><span class="toc-section-number">4.2</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="5-splitting.html#splitting"><span class="toc-section-number">5</span> Spending our Data</a>
<ul>
<li><a href="5.1-splitting-methods.html#splitting-methods"><span class="toc-section-number">5.1</span> Common Methods for Splitting Data</a></li>
<li><a href="5.2-what-about-a-validation-set.html#what-about-a-validation-set"><span class="toc-section-number">5.2</span> What About a Validation Set?</a></li>
<li><a href="5.3-multi-level-data.html#multi-level-data"><span class="toc-section-number">5.3</span> Multi-Level Data</a></li>
<li><a href="5.4-other-considerations-for-a-data-budget.html#other-considerations-for-a-data-budget"><span class="toc-section-number">5.4</span> Other Considerations for a Data Budget</a></li>
<li><a href="5.5-splitting-summary.html#splitting-summary"><span class="toc-section-number">5.5</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="6-models.html#models"><span class="toc-section-number">6</span> Fitting Models with parsnip</a>
<ul>
<li><a href="6.1-create-a-model.html#create-a-model"><span class="toc-section-number">6.1</span> Create a Model</a></li>
<li><a href="6.2-use-the-model-results.html#use-the-model-results"><span class="toc-section-number">6.2</span> Use the Model Results</a></li>
<li><a href="6.3-parsnip-predictions.html#parsnip-predictions"><span class="toc-section-number">6.3</span> Make Predictions</a></li>
<li><a href="6.4-parsnip-extension-packages.html#parsnip-extension-packages"><span class="toc-section-number">6.4</span> parsnip-Extension Packages</a></li>
<li><a href="6.5-parsnip-addin.html#parsnip-addin"><span class="toc-section-number">6.5</span> Creating Model Specifications</a></li>
<li><a href="6.6-models-summary.html#models-summary"><span class="toc-section-number">6.6</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="7-workflows.html#workflows"><span class="toc-section-number">7</span> A Model Workflow</a>
<ul>
<li><a href="7.1-begin-model-end.html#begin-model-end"><span class="toc-section-number">7.1</span> Where Does the Model Begin and End?</a></li>
<li><a href="7.2-workflow-basics.html#workflow-basics"><span class="toc-section-number">7.2</span> Workflow Basics</a></li>
<li><a href="7.3-adding-raw-variables-to-the-workflow.html#adding-raw-variables-to-the-workflow"><span class="toc-section-number">7.3</span> Adding Raw Variables to the <code>workflow()</code></a></li>
<li class="has-sub"><a href="7.4-workflow-encoding.html#workflow-encoding"><span class="toc-section-number">7.4</span> How Does a <code>workflow()</code> Use the Formula?</a>
<ul>
<li><a href="7.4-workflow-encoding.html#tree-based-models">Tree-based models</a></li>
<li><a href="7.4-workflow-encoding.html#special-model-formulas"><span class="toc-section-number">7.4.1</span> Special formulas and in-line functions</a></li>
</ul></li>
<li><a href="7.5-workflow-sets-intro.html#workflow-sets-intro"><span class="toc-section-number">7.5</span> Creating Multiple Workflows at Once</a></li>
<li><a href="7.6-evaluating-the-test-set.html#evaluating-the-test-set"><span class="toc-section-number">7.6</span> Evaluating the Test Set</a></li>
<li><a href="7.7-workflows-summary.html#workflows-summary"><span class="toc-section-number">7.7</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="8-recipes.html#recipes"><span class="toc-section-number">8</span> Feature Engineering with recipes</a>
<ul>
<li><a href="8.1-a-simple-recipe-for-the-ames-housing-data.html#a-simple-recipe-for-the-ames-housing-data"><span class="toc-section-number">8.1</span> A Simple <code>recipe()</code> for the Ames Housing Data</a></li>
<li><a href="8.2-using-recipes.html#using-recipes"><span class="toc-section-number">8.2</span> Using Recipes</a></li>
<li><a href="8.3-how-data-are-used-by-the-recipe.html#how-data-are-used-by-the-recipe"><span class="toc-section-number">8.3</span> How Data are Used by the <code>recipe()</code></a></li>
<li class="has-sub"><a href="8.4-example-steps.html#example-steps"><span class="toc-section-number">8.4</span> Examples of <code>recipe()</code> Steps</a>
<ul>
<li><a href="8.4-example-steps.html#dummies"><span class="toc-section-number">8.4.1</span> Encoding qualitative data in a numeric format</a></li>
<li><a href="8.4-example-steps.html#interaction-terms"><span class="toc-section-number">8.4.2</span> Interaction terms</a></li>
<li><a href="8.4-example-steps.html#spline-functions"><span class="toc-section-number">8.4.3</span> Spline functions</a></li>
<li><a href="8.4-example-steps.html#feature-extraction"><span class="toc-section-number">8.4.4</span> Feature extraction</a></li>
<li><a href="8.4-example-steps.html#row-sampling-steps"><span class="toc-section-number">8.4.5</span> Row sampling steps</a></li>
<li><a href="8.4-example-steps.html#general-transformations"><span class="toc-section-number">8.4.6</span> General transformations</a></li>
<li><a href="8.4-example-steps.html#natural-language-processing"><span class="toc-section-number">8.4.7</span> Natural language processing</a></li>
</ul></li>
<li><a href="8.5-skip-equals-true.html#skip-equals-true"><span class="toc-section-number">8.5</span> Skipping Steps for New Data</a></li>
<li><a href="8.6-tidy-a-recipe.html#tidy-a-recipe"><span class="toc-section-number">8.6</span> Tidy a <code>recipe()</code></a></li>
<li><a href="8.7-column-roles.html#column-roles"><span class="toc-section-number">8.7</span> Column Roles</a></li>
<li><a href="8.8-recipes-summary.html#recipes-summary"><span class="toc-section-number">8.8</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="9-performance.html#performance"><span class="toc-section-number">9</span> Judging Model Effectiveness</a>
<ul>
<li><a href="9.1-performance-metrics-and-inference.html#performance-metrics-and-inference"><span class="toc-section-number">9.1</span> Performance Metrics and Inference</a></li>
<li><a href="9.2-regression-metrics.html#regression-metrics"><span class="toc-section-number">9.2</span> Regression Metrics</a></li>
<li><a href="9.3-binary-classification-metrics.html#binary-classification-metrics"><span class="toc-section-number">9.3</span> Binary Classification Metrics</a></li>
<li><a href="9.4-multi-class-classification-metrics.html#multi-class-classification-metrics"><span class="toc-section-number">9.4</span> Multi-Class Classification Metrics</a></li>
<li><a href="9.5-performance-summary.html#performance-summary"><span class="toc-section-number">9.5</span> Chapter Summary</a></li>
</ul></li>
<li class="part"><span><b>Tools for Creating Effective Models</b></span></li>
<li class="has-sub"><a href="10-resampling.html#resampling"><span class="toc-section-number">10</span> Resampling for Evaluating Performance</a>
<ul>
<li><a href="10.1-resampling-resubstition.html#resampling-resubstition"><span class="toc-section-number">10.1</span> The Resubstitution Approach</a></li>
<li class="has-sub"><a href="10.2-resampling-methods.html#resampling-methods"><span class="toc-section-number">10.2</span> Resampling Methods</a>
<ul>
<li><a href="10.2-resampling-methods.html#cv"><span class="toc-section-number">10.2.1</span> Cross-validation</a></li>
<li><a href="10.2-resampling-methods.html#repeated-cross-validation">Repeated cross-validation</a></li>
<li><a href="10.2-resampling-methods.html#leave-one-out-cross-validation">Leave-one-out cross-validation</a></li>
<li><a href="10.2-resampling-methods.html#monte-carlo-cross-validation">Monte Carlo cross-validation</a></li>
<li><a href="10.2-resampling-methods.html#validation"><span class="toc-section-number">10.2.2</span> Validation sets</a></li>
<li><a href="10.2-resampling-methods.html#bootstrap"><span class="toc-section-number">10.2.3</span> Bootstrapping</a></li>
<li><a href="10.2-resampling-methods.html#rolling"><span class="toc-section-number">10.2.4</span> Rolling forecasting origin resampling</a></li>
</ul></li>
<li><a href="10.3-resampling-performance.html#resampling-performance"><span class="toc-section-number">10.3</span> Estimating Performance</a></li>
<li><a href="10.4-parallel.html#parallel"><span class="toc-section-number">10.4</span> Parallel Processing</a></li>
<li><a href="10.5-extract.html#extract"><span class="toc-section-number">10.5</span> Saving the Resampled Objects</a></li>
<li><a href="10.6-resampling-summary.html#resampling-summary"><span class="toc-section-number">10.6</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="11-compare.html#compare"><span class="toc-section-number">11</span> Comparing Models with Resampling</a>
<ul>
<li><a href="11.1-workflow-set.html#workflow-set"><span class="toc-section-number">11.1</span> Creating Multiple Models with Workflow Sets</a></li>
<li><a href="11.2-resampled-stats.html#resampled-stats"><span class="toc-section-number">11.2</span> Comparing Resampled Performance Statistics</a></li>
<li><a href="11.3-simple-hypothesis-testing-methods.html#simple-hypothesis-testing-methods"><span class="toc-section-number">11.3</span> Simple Hypothesis Testing Methods</a></li>
<li class="has-sub"><a href="11.4-tidyposterior.html#tidyposterior"><span class="toc-section-number">11.4</span> Bayesian Methods</a>
<ul>
<li><a href="11.4-tidyposterior.html#the-effect-of-the-amount-of-resampling">The effect of the amount of resampling</a></li>
</ul></li>
<li><a href="11.5-compare-summary.html#compare-summary"><span class="toc-section-number">11.5</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="12-tuning.html#tuning"><span class="toc-section-number">12</span> Model Tuning and the Dangers of Overfitting</a>
<ul>
<li><a href="12.1-model-parameters.html#model-parameters"><span class="toc-section-number">12.1</span> Model Parameters</a></li>
<li><a href="12.2-tuning-parameter-examples.html#tuning-parameter-examples"><span class="toc-section-number">12.2</span> Tuning Parameters for Different Types of Models</a></li>
<li><a href="12.3-what-to-optimize.html#what-to-optimize"><span class="toc-section-number">12.3</span> What do we Optimize?</a></li>
<li><a href="12.4-overfitting-bad.html#overfitting-bad"><span class="toc-section-number">12.4</span> The consequences of poor parameter estimates</a></li>
<li><a href="12.5-two-general-strategies-for-optimization.html#two-general-strategies-for-optimization"><span class="toc-section-number">12.5</span> Two general strategies for optimization</a></li>
<li><a href="12.6-tuning-params-tidymodels.html#tuning-params-tidymodels"><span class="toc-section-number">12.6</span> Tuning Parameters in tidymodels</a></li>
<li><a href="12.7-chapter-summary-2.html#chapter-summary-2"><span class="toc-section-number">12.7</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="13-grid-search.html#grid-search"><span class="toc-section-number">13</span> Grid Search</a>
<ul>
<li class="has-sub"><a href="13.1-grids.html#grids"><span class="toc-section-number">13.1</span> Regular and Non-Regular Grids</a>
<ul>
<li><a href="13.1-grids.html#regular-grids">Regular grids</a></li>
<li><a href="13.1-grids.html#irregular-grids">Irregular grids</a></li>
</ul></li>
<li><a href="13.2-evaluating-grid.html#evaluating-grid"><span class="toc-section-number">13.2</span> Evaluating the Grid</a></li>
<li><a href="13.3-finalizing-the-model.html#finalizing-the-model"><span class="toc-section-number">13.3</span> Finalizing the Model</a></li>
<li><a href="13.4-tuning-usemodels.html#tuning-usemodels"><span class="toc-section-number">13.4</span> Tools for Creating Tuning Specifications</a></li>
<li class="has-sub"><a href="13.5-efficient-grids.html#efficient-grids"><span class="toc-section-number">13.5</span> Tools for Efficient Grid Search</a>
<ul>
<li><a href="13.5-efficient-grids.html#submodel-trick"><span class="toc-section-number">13.5.1</span> Submodel optimization</a></li>
<li><a href="13.5-efficient-grids.html#parallel-processing"><span class="toc-section-number">13.5.2</span> Parallel processing</a></li>
<li><a href="13.5-efficient-grids.html#benchmarking-boosted-trees"><span class="toc-section-number">13.5.3</span> Benchmarking boosted trees</a></li>
<li><a href="13.5-efficient-grids.html#access-to-global-variables"><span class="toc-section-number">13.5.4</span> Access to global variables</a></li>
<li><a href="13.5-efficient-grids.html#racing"><span class="toc-section-number">13.5.5</span> Racing methods</a></li>
</ul></li>
<li><a href="13.6-grid-summary.html#grid-summary"><span class="toc-section-number">13.6</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="14-iterative-search.html#iterative-search"><span class="toc-section-number">14</span> Iterative Search</a>
<ul>
<li><a href="14.1-svm.html#svm"><span class="toc-section-number">14.1</span> A Support Vector Machine Model</a></li>
<li class="has-sub"><a href="14.2-bayesian-optimization.html#bayesian-optimization"><span class="toc-section-number">14.2</span> Bayesian Optimization</a>
<ul>
<li><a href="14.2-bayesian-optimization.html#a-gaussian-process-model"><span class="toc-section-number">14.2.1</span> A Gaussian process model</a></li>
<li><a href="14.2-bayesian-optimization.html#acquisition-functions"><span class="toc-section-number">14.2.2</span> Acquisition functions</a></li>
<li><a href="14.2-bayesian-optimization.html#tune-bayes"><span class="toc-section-number">14.2.3</span> The <code>tune_bayes()</code> function</a></li>
</ul></li>
<li class="has-sub"><a href="14.3-simulated-annealing.html#simulated-annealing"><span class="toc-section-number">14.3</span> Simulated Annealing</a>
<ul>
<li><a href="14.3-simulated-annealing.html#simulated-annealing-search-process"><span class="toc-section-number">14.3.1</span> Simulated annealing search process</a></li>
<li><a href="14.3-simulated-annealing.html#tune-sim-anneal"><span class="toc-section-number">14.3.2</span> The <code>tune_sim_anneal()</code> function</a></li>
</ul></li>
<li><a href="14.4-iterative-summary.html#iterative-summary"><span class="toc-section-number">14.4</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="15-workflow-sets.html#workflow-sets"><span class="toc-section-number">15</span> Screening Many Models</a>
<ul>
<li><a href="15.1-modeling-concrete-mixture-strength.html#modeling-concrete-mixture-strength"><span class="toc-section-number">15.1</span> Modeling Concrete Mixture Strength</a></li>
<li><a href="15.2-creating-the-workflow-set.html#creating-the-workflow-set"><span class="toc-section-number">15.2</span> Creating the Workflow Set</a></li>
<li><a href="15.3-tuning-and-evaluating-the-models.html#tuning-and-evaluating-the-models"><span class="toc-section-number">15.3</span> Tuning and Evaluating the Models</a></li>
<li><a href="15.4-racing-example.html#racing-example"><span class="toc-section-number">15.4</span> Efficiently Screening Models</a></li>
<li><a href="15.5-finalizing-a-model.html#finalizing-a-model"><span class="toc-section-number">15.5</span> Finalizing a Model</a></li>
<li><a href="15.6-workflow-sets-summary.html#workflow-sets-summary"><span class="toc-section-number">15.6</span> Chapter Summary</a></li>
</ul></li>
<li class="part"><span><b>Beyond the Basics</b></span></li>
<li class="has-sub"><a href="16-dimensionality.html#dimensionality"><span class="toc-section-number">16</span> Dimensionality Reduction</a>
<ul>
<li><a href="16.1-when-problems-can-dimensionality-reduction-solve.html#when-problems-can-dimensionality-reduction-solve"><span class="toc-section-number">16.1</span> When Problems Can Dimensionality Reduction Solve?</a></li>
<li><a href="16.2-beans.html#beans"><span class="toc-section-number">16.2</span> A Picture is Worth a Thousand… Beans</a></li>
<li><a href="16.3-a-starter-recipe.html#a-starter-recipe"><span class="toc-section-number">16.3</span> A Starter Recipe</a></li>
<li class="has-sub"><a href="16.4-recipe-functions.html#recipe-functions"><span class="toc-section-number">16.4</span> Recipes in the Wild</a>
<ul>
<li><a href="16.4-recipe-functions.html#prep"><span class="toc-section-number">16.4.1</span> Preparing a recipe</a></li>
<li><a href="16.4-recipe-functions.html#bake"><span class="toc-section-number">16.4.2</span> Baking the recipe</a></li>
</ul></li>
<li class="has-sub"><a href="16.5-feature-extraction-techniques.html#feature-extraction-techniques"><span class="toc-section-number">16.5</span> Feature Extraction Techniques</a>
<ul>
<li><a href="16.5-feature-extraction-techniques.html#principal-component-analysis"><span class="toc-section-number">16.5.1</span> Principal component analysis</a></li>
<li><a href="16.5-feature-extraction-techniques.html#partial-least-squares"><span class="toc-section-number">16.5.2</span> Partial least squares</a></li>
<li><a href="16.5-feature-extraction-techniques.html#independent-component-analysis"><span class="toc-section-number">16.5.3</span> Independent component analysis</a></li>
<li><a href="16.5-feature-extraction-techniques.html#uniform-manifold-approximation-and-projection"><span class="toc-section-number">16.5.4</span> Uniform manifold approximation and projection</a></li>
</ul></li>
<li><a href="16.6-bean-models.html#bean-models"><span class="toc-section-number">16.6</span> Modeling</a></li>
<li><a href="16.7-dimensionality-summary.html#dimensionality-summary"><span class="toc-section-number">16.7</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="17-categorical.html#categorical"><span class="toc-section-number">17</span> Encoding Categorical Data</a>
<ul>
<li><a href="17.1-is-an-encoding-necessary.html#is-an-encoding-necessary"><span class="toc-section-number">17.1</span> Is an Encoding Necessary?</a></li>
<li><a href="17.2-encoding-ordinal-predictors.html#encoding-ordinal-predictors"><span class="toc-section-number">17.2</span> Encoding Ordinal Predictors</a></li>
<li class="has-sub"><a href="17.3-using-the-outcome-for-encoding-predictors.html#using-the-outcome-for-encoding-predictors"><span class="toc-section-number">17.3</span> Using the Outcome for Encoding Predictors</a>
<ul>
<li><a href="17.3-using-the-outcome-for-encoding-predictors.html#effect-encodings-with-partial-pooling"><span class="toc-section-number">17.3.1</span> Effect encodings with partial pooling</a></li>
</ul></li>
<li><a href="17.4-feature-hashing.html#feature-hashing"><span class="toc-section-number">17.4</span> Feature Hashing</a></li>
<li><a href="17.5-more-encoding-options.html#more-encoding-options"><span class="toc-section-number">17.5</span> More Encoding Options</a></li>
<li><a href="17.6-categorical-summary.html#categorical-summary"><span class="toc-section-number">17.6</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="18-explain.html#explain"><span class="toc-section-number">18</span> Explaining Models and Predictions</a>
<ul>
<li><a href="18.1-software-for-model-explanations.html#software-for-model-explanations"><span class="toc-section-number">18.1</span> Software for Model Explanations</a></li>
<li><a href="18.2-local-explanations.html#local-explanations"><span class="toc-section-number">18.2</span> Local Explanations</a></li>
<li><a href="18.3-global-explanations.html#global-explanations"><span class="toc-section-number">18.3</span> Global Explanations</a></li>
<li><a href="18.4-building-global-explanations-from-local-explanations.html#building-global-explanations-from-local-explanations"><span class="toc-section-number">18.4</span> Building Global Explanations from Local Explanations</a></li>
<li><a href="18.5-back-to-beans.html#back-to-beans"><span class="toc-section-number">18.5</span> Back to Beans!</a></li>
<li><a href="18.6-explain-summary.html#explain-summary"><span class="toc-section-number">18.6</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="19-trust.html#trust"><span class="toc-section-number">19</span> When Should You Trust Your Predictions?</a>
<ul>
<li><a href="19.1-equivocal-zones.html#equivocal-zones"><span class="toc-section-number">19.1</span> Equivocal Results</a></li>
<li><a href="19.2-applicability-domains.html#applicability-domains"><span class="toc-section-number">19.2</span> Determining Model Applicability</a></li>
<li><a href="19.3-trust-summary.html#trust-summary"><span class="toc-section-number">19.3</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="20-ensembles.html#ensembles"><span class="toc-section-number">20</span> Ensembles of Models</a>
<ul>
<li><a href="20.1-data-stack.html#data-stack"><span class="toc-section-number">20.1</span> Creating the Training Set for Stacking</a></li>
<li><a href="20.2-blend-predictions.html#blend-predictions"><span class="toc-section-number">20.2</span> Blend the Predictions</a></li>
<li><a href="20.3-fit-members.html#fit-members"><span class="toc-section-number">20.3</span> Fit the Member Models</a></li>
<li><a href="20.4-test-set-results.html#test-set-results"><span class="toc-section-number">20.4</span> Test Set Results</a></li>
<li><a href="20.5-ensembles-summary.html#ensembles-summary"><span class="toc-section-number">20.5</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="21-inferential.html#inferential"><span class="toc-section-number">21</span> Inferential Analysis</a>
<ul>
<li><a href="21.1-inference-for-count-data.html#inference-for-count-data"><span class="toc-section-number">21.1</span> Inference for Count Data</a></li>
<li><a href="21.2-comparisons-with-two-sample-tests.html#comparisons-with-two-sample-tests"><span class="toc-section-number">21.2</span> Comparisons with Two-Sample Tests</a></li>
<li><a href="21.3-log-linear-models.html#log-linear-models"><span class="toc-section-number">21.3</span> Log-Linear Models</a></li>
<li><a href="21.4-a-more-complex-model.html#a-more-complex-model"><span class="toc-section-number">21.4</span> A More Complex Model</a></li>
<li><a href="21.5-inference-options.html#inference-options"><span class="toc-section-number">21.5</span> More Inferential Analysis</a></li>
<li><a href="21.6-inference-summary.html#inference-summary"><span class="toc-section-number">21.6</span> Chapter Summary</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li><a href="A-pre-proc-table.html#pre-proc-table"><span class="toc-section-number">A</span> Recommended Preprocessing</a></li>
<li><a href="references.html#references">REFERENCES</a></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="applicability-domains" class="section level2" number="19.2">
<h2><span class="header-section-number">19.2</span> Determining Model Applicability</h2>
<p>Equivocal zones try to measure the reliability of a prediction based on the model outputs. It may be that model statistics, such as the standard error of prediction, cannot measure the impact of extrapolation and we need another way to assess whether to trust a prediction and answer, “Is our model applicable for predicting a specific data point?” Let’s take the Chicago train data used extensively in <a href="https://bookdown.org/max/FES/chicago-intro.html">Kuhn and Johnson (2019)</a> and first shown in Chapter <a href="2-tidyverse.html#tidyverse">2</a>. The goal is to predict the number of customers entering the Clark and Lake train station each day.</p>
<p>The data set in the <span class="pkg">modeldata</span> package (a tidymodels package with example data sets) has daily values between January 22, 2001 and August 28, 2016. Let’s create a small test set using the last two weeks of the data:</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="19.2-applicability-domains.html#cb331-1" aria-hidden="true" tabindex="-1"></a><span class="do">## loads both `Chicago` dataset as well as `stations`</span></span>
<span id="cb331-2"><a href="19.2-applicability-domains.html#cb331-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Chicago)</span>
<span id="cb331-3"><a href="19.2-applicability-domains.html#cb331-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb331-4"><a href="19.2-applicability-domains.html#cb331-4" aria-hidden="true" tabindex="-1"></a>Chicago <span class="ot">&lt;-</span> Chicago <span class="sc">%&gt;%</span> <span class="fu">select</span>(ridership, date, <span class="fu">one_of</span>(stations))</span>
<span id="cb331-5"><a href="19.2-applicability-domains.html#cb331-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb331-6"><a href="19.2-applicability-domains.html#cb331-6" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(Chicago)</span>
<span id="cb331-7"><a href="19.2-applicability-domains.html#cb331-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb331-8"><a href="19.2-applicability-domains.html#cb331-8" aria-hidden="true" tabindex="-1"></a>Chicago_train <span class="ot">&lt;-</span> Chicago <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span>(n <span class="sc">-</span> <span class="dv">14</span>))</span>
<span id="cb331-9"><a href="19.2-applicability-domains.html#cb331-9" aria-hidden="true" tabindex="-1"></a>Chicago_test  <span class="ot">&lt;-</span> Chicago <span class="sc">%&gt;%</span> <span class="fu">slice</span>((n <span class="sc">-</span> <span class="dv">13</span>)<span class="sc">:</span>n)</span></code></pre></div>
<p>The main predictors are lagged ridership data at different train stations, including Clark and Lake, as well as the date. The ridership predictors are highly correlated with one another. In the recipe below, the date column is expanded into several new features and the ridership predictors are represented using partial least squares (PLS) components. PLS <span class="citation">(<a href="#ref-Geladi:1986" role="doc-biblioref">Geladi and Kowalski 1986</a>)</span>, as we discussed in Chapter <a href="16-dimensionality.html#dimensionality">16</a>, is a supervised version of principal component analysis where the new features have been decorrelated but are predictive of the outcome data.</p>
<p>Using the preprocessed data, we fit a standard linear model:</p>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="19.2-applicability-domains.html#cb332-1" aria-hidden="true" tabindex="-1"></a>base_recipe <span class="ot">&lt;-</span></span>
<span id="cb332-2"><a href="19.2-applicability-domains.html#cb332-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recipe</span>(ridership <span class="sc">~</span> ., <span class="at">data =</span> Chicago_train) <span class="sc">%&gt;%</span></span>
<span id="cb332-3"><a href="19.2-applicability-domains.html#cb332-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create date features</span></span>
<span id="cb332-4"><a href="19.2-applicability-domains.html#cb332-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_date</span>(date) <span class="sc">%&gt;%</span></span>
<span id="cb332-5"><a href="19.2-applicability-domains.html#cb332-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_holiday</span>(date) <span class="sc">%&gt;%</span></span>
<span id="cb332-6"><a href="19.2-applicability-domains.html#cb332-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Change date to be an id column instead of a predictor</span></span>
<span id="cb332-7"><a href="19.2-applicability-domains.html#cb332-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update_role</span>(date, <span class="at">new_role =</span> <span class="st">&quot;id&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb332-8"><a href="19.2-applicability-domains.html#cb332-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create dummy variables from factor columns</span></span>
<span id="cb332-9"><a href="19.2-applicability-domains.html#cb332-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb332-10"><a href="19.2-applicability-domains.html#cb332-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove any columns with a single unique value</span></span>
<span id="cb332-11"><a href="19.2-applicability-domains.html#cb332-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb332-12"><a href="19.2-applicability-domains.html#cb332-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="sc">!!!</span>stations)<span class="sc">%&gt;%</span></span>
<span id="cb332-13"><a href="19.2-applicability-domains.html#cb332-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_pls</span>(<span class="sc">!!!</span>stations, <span class="at">num_comp =</span> <span class="dv">10</span>, <span class="at">outcome =</span> <span class="fu">vars</span>(ridership))</span>
<span id="cb332-14"><a href="19.2-applicability-domains.html#cb332-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb332-15"><a href="19.2-applicability-domains.html#cb332-15" aria-hidden="true" tabindex="-1"></a>lm_spec <span class="ot">&lt;-</span></span>
<span id="cb332-16"><a href="19.2-applicability-domains.html#cb332-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">linear_reg</span>() <span class="sc">%&gt;%</span></span>
<span id="cb332-17"><a href="19.2-applicability-domains.html#cb332-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;lm&quot;</span>) </span>
<span id="cb332-18"><a href="19.2-applicability-domains.html#cb332-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb332-19"><a href="19.2-applicability-domains.html#cb332-19" aria-hidden="true" tabindex="-1"></a>lm_wflow <span class="ot">&lt;-</span></span>
<span id="cb332-20"><a href="19.2-applicability-domains.html#cb332-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb332-21"><a href="19.2-applicability-domains.html#cb332-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(base_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb332-22"><a href="19.2-applicability-domains.html#cb332-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(lm_spec)</span>
<span id="cb332-23"><a href="19.2-applicability-domains.html#cb332-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb332-24"><a href="19.2-applicability-domains.html#cb332-24" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1902</span>)</span>
<span id="cb332-25"><a href="19.2-applicability-domains.html#cb332-25" aria-hidden="true" tabindex="-1"></a>lm_fit <span class="ot">&lt;-</span> <span class="fu">fit</span>(lm_wflow, <span class="at">data =</span> Chicago_train)</span></code></pre></div>
<p>How well do the data fit on the test set? We can <code>predict()</code> for the test set to find both predictions and prediction intervals:</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="19.2-applicability-domains.html#cb333-1" aria-hidden="true" tabindex="-1"></a>res_test <span class="ot">&lt;-</span></span>
<span id="cb333-2"><a href="19.2-applicability-domains.html#cb333-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(lm_fit, Chicago_test) <span class="sc">%&gt;%</span></span>
<span id="cb333-3"><a href="19.2-applicability-domains.html#cb333-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(</span>
<span id="cb333-4"><a href="19.2-applicability-domains.html#cb333-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">predict</span>(lm_fit, Chicago_test, <span class="at">type =</span> <span class="st">&quot;pred_int&quot;</span>),</span>
<span id="cb333-5"><a href="19.2-applicability-domains.html#cb333-5" aria-hidden="true" tabindex="-1"></a>    Chicago_test</span>
<span id="cb333-6"><a href="19.2-applicability-domains.html#cb333-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb333-7"><a href="19.2-applicability-domains.html#cb333-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb333-8"><a href="19.2-applicability-domains.html#cb333-8" aria-hidden="true" tabindex="-1"></a>res_test <span class="sc">%&gt;%</span> <span class="fu">select</span>(date, ridership, <span class="fu">starts_with</span>(<span class="st">&quot;.pred&quot;</span>))</span>
<span id="cb333-9"><a href="19.2-applicability-domains.html#cb333-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 14 × 5</span></span>
<span id="cb333-10"><a href="19.2-applicability-domains.html#cb333-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   date       ridership .pred .pred_lower .pred_upper</span></span>
<span id="cb333-11"><a href="19.2-applicability-domains.html#cb333-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;date&gt;         &lt;dbl&gt; &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;</span></span>
<span id="cb333-12"><a href="19.2-applicability-domains.html#cb333-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 2016-08-15     20.6  20.3        16.2         24.5</span></span>
<span id="cb333-13"><a href="19.2-applicability-domains.html#cb333-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 2016-08-16     21.0  21.3        17.1         25.4</span></span>
<span id="cb333-14"><a href="19.2-applicability-domains.html#cb333-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 2016-08-17     21.0  21.4        17.3         25.6</span></span>
<span id="cb333-15"><a href="19.2-applicability-domains.html#cb333-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 2016-08-18     21.3  21.4        17.3         25.5</span></span>
<span id="cb333-16"><a href="19.2-applicability-domains.html#cb333-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 2016-08-19     20.4  20.9        16.7         25.0</span></span>
<span id="cb333-17"><a href="19.2-applicability-domains.html#cb333-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 2016-08-20      6.22  7.52        3.34        11.7</span></span>
<span id="cb333-18"><a href="19.2-applicability-domains.html#cb333-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 8 more rows</span></span>
<span id="cb333-19"><a href="19.2-applicability-domains.html#cb333-19" aria-hidden="true" tabindex="-1"></a>res_test <span class="sc">%&gt;%</span> <span class="fu">rmse</span>(ridership, .pred)</span>
<span id="cb333-20"><a href="19.2-applicability-domains.html#cb333-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 3</span></span>
<span id="cb333-21"><a href="19.2-applicability-domains.html#cb333-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .metric .estimator .estimate</span></span>
<span id="cb333-22"><a href="19.2-applicability-domains.html#cb333-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span id="cb333-23"><a href="19.2-applicability-domains.html#cb333-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 rmse    standard       0.865</span></span></code></pre></div>
<p>These are fairly good results. Figure <a href="19.2-applicability-domains.html#fig:chicago-2016">19.4</a> visualizes the predictions along with 95% prediction intervals.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:chicago-2016"></span>
<img src="figures/chicago-2016-1.png" alt="Two weeks of 2016 predictions for the Chicago data along with 95% prediction intervals. The model fit the data fairly well with reasonable error estimates." width="80%" />
<p class="caption">
Figure 19.4: Two weeks of 2016 predictions for the Chicago data along with 95% prediction intervals.
</p>
</div>
<p>Given the scale of the ridership numbers, these results look particularly good for such a simple model. If this model were deployed, how well would it have done a few years later in June of 2020? The model successfully makes a prediction, as a predictive model almost always will when given input data:</p>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="19.2-applicability-domains.html#cb334-1" aria-hidden="true" tabindex="-1"></a>res_2020 <span class="ot">&lt;-</span></span>
<span id="cb334-2"><a href="19.2-applicability-domains.html#cb334-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(lm_fit, Chicago_2020) <span class="sc">%&gt;%</span></span>
<span id="cb334-3"><a href="19.2-applicability-domains.html#cb334-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(</span>
<span id="cb334-4"><a href="19.2-applicability-domains.html#cb334-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">predict</span>(lm_fit, Chicago_2020, <span class="at">type =</span> <span class="st">&quot;pred_int&quot;</span>),</span>
<span id="cb334-5"><a href="19.2-applicability-domains.html#cb334-5" aria-hidden="true" tabindex="-1"></a>    Chicago_2020</span>
<span id="cb334-6"><a href="19.2-applicability-domains.html#cb334-6" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb334-7"><a href="19.2-applicability-domains.html#cb334-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb334-8"><a href="19.2-applicability-domains.html#cb334-8" aria-hidden="true" tabindex="-1"></a>res_2020 <span class="sc">%&gt;%</span> <span class="fu">select</span>(date, <span class="fu">contains</span>(<span class="st">&quot;.pred&quot;</span>))</span>
<span id="cb334-9"><a href="19.2-applicability-domains.html#cb334-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 14 × 4</span></span>
<span id="cb334-10"><a href="19.2-applicability-domains.html#cb334-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   date       .pred .pred_lower .pred_upper</span></span>
<span id="cb334-11"><a href="19.2-applicability-domains.html#cb334-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;date&gt;     &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;</span></span>
<span id="cb334-12"><a href="19.2-applicability-domains.html#cb334-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 2020-06-01 20.1        15.9         24.3</span></span>
<span id="cb334-13"><a href="19.2-applicability-domains.html#cb334-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 2020-06-02 21.4        17.2         25.6</span></span>
<span id="cb334-14"><a href="19.2-applicability-domains.html#cb334-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 2020-06-03 21.5        17.3         25.6</span></span>
<span id="cb334-15"><a href="19.2-applicability-domains.html#cb334-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 2020-06-04 21.3        17.1         25.4</span></span>
<span id="cb334-16"><a href="19.2-applicability-domains.html#cb334-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 2020-06-05 20.7        16.6         24.9</span></span>
<span id="cb334-17"><a href="19.2-applicability-domains.html#cb334-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 2020-06-06  9.04        4.88        13.2</span></span>
<span id="cb334-18"><a href="19.2-applicability-domains.html#cb334-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 8 more rows</span></span></code></pre></div>
<p>The prediction intervals are about the same width, even though these data are well beyond the time period of the original training set. However, given the global pandemic in 2020, the performance on these data are abysmal:</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="19.2-applicability-domains.html#cb335-1" aria-hidden="true" tabindex="-1"></a>res_2020 <span class="sc">%&gt;%</span> <span class="fu">select</span>(date, ridership, <span class="fu">starts_with</span>(<span class="st">&quot;.pred&quot;</span>))</span>
<span id="cb335-2"><a href="19.2-applicability-domains.html#cb335-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 14 × 5</span></span>
<span id="cb335-3"><a href="19.2-applicability-domains.html#cb335-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   date       ridership .pred .pred_lower .pred_upper</span></span>
<span id="cb335-4"><a href="19.2-applicability-domains.html#cb335-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;date&gt;         &lt;dbl&gt; &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;</span></span>
<span id="cb335-5"><a href="19.2-applicability-domains.html#cb335-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 2020-06-01     0.002 20.1        15.9         24.3</span></span>
<span id="cb335-6"><a href="19.2-applicability-domains.html#cb335-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 2020-06-02     0.005 21.4        17.2         25.6</span></span>
<span id="cb335-7"><a href="19.2-applicability-domains.html#cb335-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 2020-06-03     0.566 21.5        17.3         25.6</span></span>
<span id="cb335-8"><a href="19.2-applicability-domains.html#cb335-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 2020-06-04     1.66  21.3        17.1         25.4</span></span>
<span id="cb335-9"><a href="19.2-applicability-domains.html#cb335-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 2020-06-05     1.95  20.7        16.6         24.9</span></span>
<span id="cb335-10"><a href="19.2-applicability-domains.html#cb335-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 2020-06-06     1.08   9.04        4.88        13.2</span></span>
<span id="cb335-11"><a href="19.2-applicability-domains.html#cb335-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 8 more rows</span></span>
<span id="cb335-12"><a href="19.2-applicability-domains.html#cb335-12" aria-hidden="true" tabindex="-1"></a>res_2020 <span class="sc">%&gt;%</span> <span class="fu">rmse</span>(ridership, .pred)</span>
<span id="cb335-13"><a href="19.2-applicability-domains.html#cb335-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 3</span></span>
<span id="cb335-14"><a href="19.2-applicability-domains.html#cb335-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .metric .estimator .estimate</span></span>
<span id="cb335-15"><a href="19.2-applicability-domains.html#cb335-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span id="cb335-16"><a href="19.2-applicability-domains.html#cb335-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 rmse    standard        17.2</span></span></code></pre></div>
<p>Look at this terrible model performance visually in Figure <a href="19.2-applicability-domains.html#fig:chicago-2020">19.5</a>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:chicago-2020"></span>
<img src="figures/chicago-2020-1.png" alt="Two weeks of 2016 predictions for the Chicago data along with 95% prediction intervals. The model fit the data fairly well with reasonable error estimates." width="80%" />
<p class="caption">
Figure 19.5: Two weeks of 2020 predictions for the Chicago data along with 95% prediction intervals.
</p>
</div>
<p>Confidence and prediction intervals for linear regression expand as the data become more and more removed from the center of the training set. However, that effect is not dramatic enough to flag these predictions as being poor.</p>
<div class="rmdwarning">
<p>Sometimes the statistics produced by models don’t measure the quality of predictions very well.</p>
</div>
<p>This situation can be avoided by having a secondary methodology that can quantify how applicable the model is for any new prediction (i.e., the model’s <em>applicability domain</em>). There are a variety of methods to compute an applicability domain model, such as <span class="citation">Jaworska, Nikolova-Jeliazkova, and Aldenberg (<a href="#ref-Jaworska" role="doc-biblioref">2005</a>)</span> or <span class="citation">Netzeva et al. (<a href="#ref-Netzeva" role="doc-biblioref">2005</a>)</span>. The approach used in this chapter is a fairly simple unsupervised method that attempts to measure how much (if any) a new data point is beyond the training data.<a href="#fn34" class="footnote-ref" id="fnref34"><sup>34</sup></a></p>
<div class="rmdnote">
<p>The idea is to accompany a prediction with a score that measures how similar the new point is to the training set.</p>
</div>
<p>One method that works well uses principal component analysis (PCA) on the numeric predictor values. We’ll illustrate the process by using only two of the predictors that correspond to ridership at different stations (California and Austin stations). The training set are shown in panel (a) in Figure <a href="19.2-applicability-domains.html#fig:pca-reference-dist">19.6</a>. The ridership data for these stations are highly correlated and the two distributions shown in the scatter plot correspond to ridership on the weekends and week days.</p>
<p>The first step is to conduct PCA on the training data. The PCA scores for the training set are shown in panel (b) in Figure <a href="19.2-applicability-domains.html#fig:pca-reference-dist">19.6</a>. Next, using these results, we measure the distance of each training set point to the center of the PCA data (panel (c) of Figure <a href="19.2-applicability-domains.html#fig:pca-reference-dist">19.6</a>). We can then use this <em>reference distribution</em> (panel (d) of Figure <a href="19.2-applicability-domains.html#fig:pca-reference-dist">19.6</a>) to estimate how far away a data point is from the mainstream of the training data.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:pca-reference-dist"></span>
<img src="figures/pca-reference-dist-1.png" alt="The PCA reference distribution based on the training set. The majority of the distances to the center of the PCA distribution are below a value of three." width="100%" />
<p class="caption">
Figure 19.6: The PCA reference distribution based on the training set.
</p>
</div>
<p>For a new sample, the PCA scores are computed along with the distance to the center of the training set.</p>
<p>However, what does it mean when a new sample has a distance of <em>X</em>? Since the PCA components can have different ranges from data set to data set, there is no obvious limit to say that a distance is too large.</p>
<p>One approach is to treat the distances from the training set data as “normal”. For new samples, we can determine how the new distance compares to the range in the reference distribution (from the training set). A percentile can be computed for new samples that reflect how much of the training set is less extreme than the new samples.</p>
<div class="rmdnote">
<p>A percentile of 90% means that most of the training set data are closer to the data center than the new sample.</p>
</div>
<p>The plot in Figure <a href="19.2-applicability-domains.html#fig:two-new-points">19.7</a> overlays a testing set sample (triangle and dashed line) and a 2020 sample (circle and solid line) with the PCA distances from the training set.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:two-new-points"></span>
<img src="figures/two-new-points-1.png" alt="The reference distribution with two new points: one using the test set and one from the 2020 data. The test set point is snugly within the data mainstream while the 2020 point is outside of the reference distribution." width="100%" />
<p class="caption">
Figure 19.7: The reference distribution with two new points: one using the test set and one from the 2020 data.
</p>
</div>
<p>The test set point has a distance of 1.28. It is in the 51.8% percentile of the training set distribution, indicating that it is snugly within the mainstream of the training set.</p>
<p>The 2020 sample is further away from the center than any of the training set samples (with a percentile of 100%). This indicates that the sample is very extreme and that its corresponding prediction would be a severe extrapolation (and probably should not be reported).</p>
<p>The <span class="pkg">applicable</span> package can develop an applicability domain model using PCA. We’ll use the 20 lagged station ridership predictors as inputs into the PCA analysis. There is an additional argument called <code>threshold</code> that determines how many components are used in the distance calculation. For our example, we’ll use a large value that indicates that we should use enough components to account for 99% of the variation in the ridership predictors:</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="19.2-applicability-domains.html#cb336-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(applicable)</span>
<span id="cb336-2"><a href="19.2-applicability-domains.html#cb336-2" aria-hidden="true" tabindex="-1"></a>pca_stat <span class="ot">&lt;-</span> <span class="fu">apd_pca</span>(<span class="sc">~</span> ., <span class="at">data =</span> Chicago_train <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">one_of</span>(stations)), </span>
<span id="cb336-3"><a href="19.2-applicability-domains.html#cb336-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">threshold =</span> <span class="fl">0.99</span>)</span>
<span id="cb336-4"><a href="19.2-applicability-domains.html#cb336-4" aria-hidden="true" tabindex="-1"></a>pca_stat</span>
<span id="cb336-5"><a href="19.2-applicability-domains.html#cb336-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # Predictors:</span></span>
<span id="cb336-6"><a href="19.2-applicability-domains.html#cb336-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    20</span></span>
<span id="cb336-7"><a href="19.2-applicability-domains.html#cb336-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # Principal Components:</span></span>
<span id="cb336-8"><a href="19.2-applicability-domains.html#cb336-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    9 components were needed</span></span>
<span id="cb336-9"><a href="19.2-applicability-domains.html#cb336-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    to capture at least 99% of the</span></span>
<span id="cb336-10"><a href="19.2-applicability-domains.html#cb336-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    total variation in the predictors.</span></span></code></pre></div>
<p>The <code>autoplot()</code> method plots the reference distribution. It has an optional argument for which data to plot. We’ll add a value of <code>distance</code> to only plot the training set distance distribution. This code generates the plot in Figure <a href="19.2-applicability-domains.html#fig:ap-autoplot">19.8</a>:</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="19.2-applicability-domains.html#cb337-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(pca_stat, distance) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;distance&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:ap-autoplot"></span>
<img src="figures/ap-autoplot-1.png" alt="The results of using the `autoplot()` method on an applicable object." width="70%" />
<p class="caption">
Figure 19.8: The results of using the <code>autoplot()</code> method on an applicable object.
</p>
</div>
<p>The x-axis shows the values of the distance and the y-axis displays the distribution’s percentiles. For example, half of the training set samples had distances less than 3.7.</p>
<p>To compute the percentiles for new data, the <code>score()</code> function works in the same way as <code>predict()</code>:</p>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="19.2-applicability-domains.html#cb338-1" aria-hidden="true" tabindex="-1"></a><span class="fu">score</span>(pca_stat, Chicago_test) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;distance&quot;</span>))</span>
<span id="cb338-2"><a href="19.2-applicability-domains.html#cb338-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 14 × 2</span></span>
<span id="cb338-3"><a href="19.2-applicability-domains.html#cb338-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   distance distance_pctl</span></span>
<span id="cb338-4"><a href="19.2-applicability-domains.html#cb338-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      &lt;dbl&gt;         &lt;dbl&gt;</span></span>
<span id="cb338-5"><a href="19.2-applicability-domains.html#cb338-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     4.88          66.7</span></span>
<span id="cb338-6"><a href="19.2-applicability-domains.html#cb338-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2     5.21          71.4</span></span>
<span id="cb338-7"><a href="19.2-applicability-domains.html#cb338-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3     5.19          71.1</span></span>
<span id="cb338-8"><a href="19.2-applicability-domains.html#cb338-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4     5.00          68.5</span></span>
<span id="cb338-9"><a href="19.2-applicability-domains.html#cb338-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5     4.36          59.3</span></span>
<span id="cb338-10"><a href="19.2-applicability-domains.html#cb338-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6     4.10          55.2</span></span>
<span id="cb338-11"><a href="19.2-applicability-domains.html#cb338-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 8 more rows</span></span></code></pre></div>
<p>These seem fairly reasonable. For the 2020 data:</p>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="19.2-applicability-domains.html#cb339-1" aria-hidden="true" tabindex="-1"></a><span class="fu">score</span>(pca_stat, Chicago_2020) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;distance&quot;</span>))</span>
<span id="cb339-2"><a href="19.2-applicability-domains.html#cb339-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 14 × 2</span></span>
<span id="cb339-3"><a href="19.2-applicability-domains.html#cb339-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   distance distance_pctl</span></span>
<span id="cb339-4"><a href="19.2-applicability-domains.html#cb339-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      &lt;dbl&gt;         &lt;dbl&gt;</span></span>
<span id="cb339-5"><a href="19.2-applicability-domains.html#cb339-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     9.39          99.8</span></span>
<span id="cb339-6"><a href="19.2-applicability-domains.html#cb339-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2     9.40          99.8</span></span>
<span id="cb339-7"><a href="19.2-applicability-domains.html#cb339-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3     9.30          99.7</span></span>
<span id="cb339-8"><a href="19.2-applicability-domains.html#cb339-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4     9.30          99.7</span></span>
<span id="cb339-9"><a href="19.2-applicability-domains.html#cb339-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5     9.29          99.7</span></span>
<span id="cb339-10"><a href="19.2-applicability-domains.html#cb339-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6    10.1            1  </span></span>
<span id="cb339-11"><a href="19.2-applicability-domains.html#cb339-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 8 more rows</span></span></code></pre></div>
<p>The 2020 distance values indicate that these predictor values are outside of the vast majority of data seen by the model at training time. These should be flagged so that the predictions are either not reported at all or taken with skepticism.</p>
<div class="rmdnote">
<p>One important aspect of this analysis concerns which predictors are used to develop the applicability domain model. In our analysis, we used the raw predictor columns. However, in building the model, PLS score features were used in their place. Which of these should <code>apd_pca()</code> use? The <code>apd_pca()</code> function can also take a recipe as the input (instead of a formula) so that the distances reflect the PLS scores instead of the individual predictor columns. You can evaluate both methods to understand which one gives more relevant results.</p>
</div>
</div>
<h3>REFERENCES</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Bartley" class="csl-entry">
Bartley, E AND Schliep, M . AND Hanks. 2019. <span>“Identifying and Characterizing Extrapolation in Multivariate Response Data.”</span> <em>PLOS ONE</em> 14 (December): 1–20.
</div>
<div id="ref-Geladi:1986" class="csl-entry">
Geladi, P., and B Kowalski. 1986. <span>“Partial Least-Squares Regression: A Tutorial.”</span> <em>Analytica Chimica Acta</em> 185: 1–17.
</div>
<div id="ref-Jaworska" class="csl-entry">
Jaworska, J, N Nikolova-Jeliazkova, and T Aldenberg. 2005. <span>“QSAR Applicability Domain Estimation by Projection of the Training Set in Descriptor Space: A Review.”</span> <em>Alternatives to Laboratory Animals</em> 33 (5): 445–59.
</div>
<div id="ref-Netzeva" class="csl-entry">
Netzeva, T, A Worth, T Aldenberg, R Benigni, M Cronin, P Gramatica, J Jaworska, et al. 2005. <span>“Current Status of Methods for Defining the Applicability Domain of (Quantitative) Structure-Activity Relationships: The Report and Recommendations of ECVAM Workshop 52.”</span> <em>Alternatives to Laboratory Animals</em> 33 (2): 155–73.
</div>
</div>
<div class="footnotes">
<hr />
<ol start="34">
<li id="fn34"><p><span class="citation">Bartley (<a href="#ref-Bartley" role="doc-biblioref">2019</a>)</span> shows yet another method and applies it to ecological studies.<a href="19.2-applicability-domains.html#fnref34" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
<p style="text-align: center;">
<a href="19.1-equivocal-zones.html"><button class="btn btn-default">Previous</button></a>
<a href="19.3-trust-summary.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

</body>
</html>
