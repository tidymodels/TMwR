<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="3.1 An Example | Tidy Modeling with R" />
<meta property="og:type" content="book" />
<meta property="og:image" content="/images/cover.png" />
<meta property="og:description" content="The tidymodels framework is a collection of R packages for modeling and machine learning using tidyverse principles. This book provides a thorough introduction to how to use tidymodels, and an outline of good methodology and statistical practice for phases of the modeling process." />
<meta name="github-repo" content="tidymodels/TMwR" />

<meta name="author" content="Max Kuhn and Julia Silge" />


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta name="description" content="The tidymodels framework is a collection of R packages for modeling and machine learning using tidyverse principles. This book provides a thorough introduction to how to use tidymodels, and an outline of good methodology and statistical practice for phases of the modeling process.">

<title>3.1 An Example | Tidy Modeling with R</title>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="libs/navigation-1.1/tabsets.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
/* show arrow before summary tag as in bootstrap
TODO: remove if boostrap in updated in html_document (rmarkdown#1485) */
details > summary {
  display: list-item;
  cursor: pointer;
}
</style>
</head>

<body>

<div class="container-fluid main-container">


<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li class="has-sub"><a href="index.html#hello-world">Hello World</a>
<ul>
<li><a href="acknowledgments.html#acknowledgments">Acknowledgments</a></li>
<li><a href="using-code-examples.html#using-code-examples">Using Code Examples</a></li>
</ul></li>
<li class="part"><span><b>Introduction</b></span></li>
<li class="has-sub"><a href="1-software-modeling.html#software-modeling"><span class="toc-section-number">1</span> Software for modeling</a>
<ul>
<li><a href="1.1-fundamentals-for-modeling-software.html#fundamentals-for-modeling-software"><span class="toc-section-number">1.1</span> Fundamentals for Modeling Software</a></li>
<li class="has-sub"><a href="1.2-model-types.html#model-types"><span class="toc-section-number">1.2</span> Types of Models</a>
<ul>
<li><a href="1.2-model-types.html#descriptive-models">Descriptive models</a></li>
<li><a href="1.2-model-types.html#inferential-models">Inferential models</a></li>
<li><a href="1.2-model-types.html#predictive-models">Predictive models</a></li>
</ul></li>
<li><a href="1.3-connections-between-types-of-models.html#connections-between-types-of-models"><span class="toc-section-number">1.3</span> Connections Between Types of Models</a></li>
<li><a href="1.4-model-terminology.html#model-terminology"><span class="toc-section-number">1.4</span> Some Terminology</a></li>
<li><a href="1.5-model-phases.html#model-phases"><span class="toc-section-number">1.5</span> How Does Modeling Fit into the Data Analysis Process?</a></li>
<li><a href="1.6-software-summary.html#software-summary"><span class="toc-section-number">1.6</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="2-tidyverse.html#tidyverse"><span class="toc-section-number">2</span> A Tidyverse Primer</a>
<ul>
<li class="has-sub"><a href="2.1-tidyverse-principles.html#tidyverse-principles"><span class="toc-section-number">2.1</span> Tidyverse Principles</a>
<ul>
<li><a href="2.1-tidyverse-principles.html#design-for-humans"><span class="toc-section-number">2.1.1</span> Design for humans</a></li>
<li><a href="2.1-tidyverse-principles.html#reuse-existing-data-structures"><span class="toc-section-number">2.1.2</span> Reuse existing data structures</a></li>
<li><a href="2.1-tidyverse-principles.html#design-for-the-pipe-and-functional-programming"><span class="toc-section-number">2.1.3</span> Design for the pipe and functional programming</a></li>
</ul></li>
<li><a href="2.2-examples-of-tidyverse-syntax.html#examples-of-tidyverse-syntax"><span class="toc-section-number">2.2</span> Examples of Tidyverse Syntax</a></li>
<li><a href="2.3-chapter-summary.html#chapter-summary"><span class="toc-section-number">2.3</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="3-base-r.html#base-r"><span class="toc-section-number">3</span> A Review of R Modeling Fundamentals</a>
<ul>
<li><a href="3.1-an-example.html#an-example"><span class="toc-section-number">3.1</span> An Example</a></li>
<li><a href="3.2-formula.html#formula"><span class="toc-section-number">3.2</span> What Does the R Formula Do?</a></li>
<li><a href="3.3-tidiness-modeling.html#tidiness-modeling"><span class="toc-section-number">3.3</span> Why Tidiness is Important for Modeling</a></li>
<li><a href="3.4-combining-base-r-models-and-the-tidyverse.html#combining-base-r-models-and-the-tidyverse"><span class="toc-section-number">3.4</span> Combining Base R Models and the Tidyverse</a></li>
<li><a href="3.5-the-tidymodels-metapackage.html#the-tidymodels-metapackage"><span class="toc-section-number">3.5</span> The tidymodels Metapackage</a></li>
<li><a href="3.6-chapter-summary-1.html#chapter-summary-1"><span class="toc-section-number">3.6</span> Chapter Summary</a></li>
</ul></li>
<li class="part"><span><b>Modeling Basics</b></span></li>
<li class="has-sub"><a href="4-ames.html#ames"><span class="toc-section-number">4</span> The Ames Housing Data</a>
<ul>
<li><a href="4.1-exploring-features-of-homes-in-ames.html#exploring-features-of-homes-in-ames"><span class="toc-section-number">4.1</span> Exploring Features of Homes in Ames</a></li>
<li><a href="4.2-ames-summary.html#ames-summary"><span class="toc-section-number">4.2</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="5-splitting.html#splitting"><span class="toc-section-number">5</span> Spending our Data</a>
<ul>
<li><a href="5.1-splitting-methods.html#splitting-methods"><span class="toc-section-number">5.1</span> Common Methods for Splitting Data</a></li>
<li><a href="5.2-what-about-a-validation-set.html#what-about-a-validation-set"><span class="toc-section-number">5.2</span> What About a Validation Set?</a></li>
<li><a href="5.3-multi-level-data.html#multi-level-data"><span class="toc-section-number">5.3</span> Multi-Level Data</a></li>
<li><a href="5.4-other-considerations-for-a-data-budget.html#other-considerations-for-a-data-budget"><span class="toc-section-number">5.4</span> Other Considerations for a Data Budget</a></li>
<li><a href="5.5-splitting-summary.html#splitting-summary"><span class="toc-section-number">5.5</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="6-models.html#models"><span class="toc-section-number">6</span> Fitting Models with parsnip</a>
<ul>
<li><a href="6.1-create-a-model.html#create-a-model"><span class="toc-section-number">6.1</span> Create a Model</a></li>
<li><a href="6.2-use-the-model-results.html#use-the-model-results"><span class="toc-section-number">6.2</span> Use the Model Results</a></li>
<li><a href="6.3-parsnip-predictions.html#parsnip-predictions"><span class="toc-section-number">6.3</span> Make Predictions</a></li>
<li><a href="6.4-parsnip-extension-packages.html#parsnip-extension-packages"><span class="toc-section-number">6.4</span> parsnip-Extension Packages</a></li>
<li><a href="6.5-parsnip-addin.html#parsnip-addin"><span class="toc-section-number">6.5</span> Creating Model Specifications</a></li>
<li><a href="6.6-models-summary.html#models-summary"><span class="toc-section-number">6.6</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="7-workflows.html#workflows"><span class="toc-section-number">7</span> A Model Workflow</a>
<ul>
<li><a href="7.1-begin-model-end.html#begin-model-end"><span class="toc-section-number">7.1</span> Where Does the Model Begin and End?</a></li>
<li><a href="7.2-workflow-basics.html#workflow-basics"><span class="toc-section-number">7.2</span> Workflow Basics</a></li>
<li><a href="7.3-adding-raw-variables-to-the-workflow.html#adding-raw-variables-to-the-workflow"><span class="toc-section-number">7.3</span> Adding Raw Variables to the <code>workflow()</code></a></li>
<li class="has-sub"><a href="7.4-workflow-encoding.html#workflow-encoding"><span class="toc-section-number">7.4</span> How Does a <code>workflow()</code> Use the Formula?</a>
<ul>
<li><a href="7.4-workflow-encoding.html#tree-based-models">Tree-based models</a></li>
<li><a href="7.4-workflow-encoding.html#special-model-formulas"><span class="toc-section-number">7.4.1</span> Special formulas and in-line functions</a></li>
</ul></li>
<li><a href="7.5-workflow-sets-intro.html#workflow-sets-intro"><span class="toc-section-number">7.5</span> Creating Multiple Workflows at Once</a></li>
<li><a href="7.6-evaluating-the-test-set.html#evaluating-the-test-set"><span class="toc-section-number">7.6</span> Evaluating the Test Set</a></li>
<li><a href="7.7-workflows-summary.html#workflows-summary"><span class="toc-section-number">7.7</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="8-recipes.html#recipes"><span class="toc-section-number">8</span> Feature Engineering with recipes</a>
<ul>
<li><a href="8.1-a-simple-recipe-for-the-ames-housing-data.html#a-simple-recipe-for-the-ames-housing-data"><span class="toc-section-number">8.1</span> A Simple <code>recipe()</code> for the Ames Housing Data</a></li>
<li><a href="8.2-using-recipes.html#using-recipes"><span class="toc-section-number">8.2</span> Using Recipes</a></li>
<li><a href="8.3-how-data-are-used-by-the-recipe.html#how-data-are-used-by-the-recipe"><span class="toc-section-number">8.3</span> How Data are Used by the <code>recipe()</code></a></li>
<li class="has-sub"><a href="8.4-example-steps.html#example-steps"><span class="toc-section-number">8.4</span> Examples of <code>recipe()</code> Steps</a>
<ul>
<li><a href="8.4-example-steps.html#dummies"><span class="toc-section-number">8.4.1</span> Encoding qualitative data in a numeric format</a></li>
<li><a href="8.4-example-steps.html#interaction-terms"><span class="toc-section-number">8.4.2</span> Interaction terms</a></li>
<li><a href="8.4-example-steps.html#spline-functions"><span class="toc-section-number">8.4.3</span> Spline functions</a></li>
<li><a href="8.4-example-steps.html#feature-extraction"><span class="toc-section-number">8.4.4</span> Feature extraction</a></li>
<li><a href="8.4-example-steps.html#row-sampling-steps"><span class="toc-section-number">8.4.5</span> Row sampling steps</a></li>
<li><a href="8.4-example-steps.html#general-transformations"><span class="toc-section-number">8.4.6</span> General transformations</a></li>
<li><a href="8.4-example-steps.html#natural-language-processing"><span class="toc-section-number">8.4.7</span> Natural language processing</a></li>
</ul></li>
<li><a href="8.5-skip-equals-true.html#skip-equals-true"><span class="toc-section-number">8.5</span> Skipping Steps for New Data</a></li>
<li><a href="8.6-tidy-a-recipe.html#tidy-a-recipe"><span class="toc-section-number">8.6</span> Tidy a <code>recipe()</code></a></li>
<li><a href="8.7-column-roles.html#column-roles"><span class="toc-section-number">8.7</span> Column Roles</a></li>
<li><a href="8.8-recipes-summary.html#recipes-summary"><span class="toc-section-number">8.8</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="9-performance.html#performance"><span class="toc-section-number">9</span> Judging Model Effectiveness</a>
<ul>
<li><a href="9.1-performance-metrics-and-inference.html#performance-metrics-and-inference"><span class="toc-section-number">9.1</span> Performance Metrics and Inference</a></li>
<li><a href="9.2-regression-metrics.html#regression-metrics"><span class="toc-section-number">9.2</span> Regression Metrics</a></li>
<li><a href="9.3-binary-classification-metrics.html#binary-classification-metrics"><span class="toc-section-number">9.3</span> Binary Classification Metrics</a></li>
<li><a href="9.4-multi-class-classification-metrics.html#multi-class-classification-metrics"><span class="toc-section-number">9.4</span> Multi-Class Classification Metrics</a></li>
<li><a href="9.5-performance-summary.html#performance-summary"><span class="toc-section-number">9.5</span> Chapter Summary</a></li>
</ul></li>
<li class="part"><span><b>Tools for Creating Effective Models</b></span></li>
<li class="has-sub"><a href="10-resampling.html#resampling"><span class="toc-section-number">10</span> Resampling for Evaluating Performance</a>
<ul>
<li><a href="10.1-resampling-resubstition.html#resampling-resubstition"><span class="toc-section-number">10.1</span> The Resubstitution Approach</a></li>
<li class="has-sub"><a href="10.2-resampling-methods.html#resampling-methods"><span class="toc-section-number">10.2</span> Resampling Methods</a>
<ul>
<li><a href="10.2-resampling-methods.html#cv"><span class="toc-section-number">10.2.1</span> Cross-validation</a></li>
<li><a href="10.2-resampling-methods.html#repeated-cross-validation">Repeated cross-validation</a></li>
<li><a href="10.2-resampling-methods.html#leave-one-out-cross-validation">Leave-one-out cross-validation</a></li>
<li><a href="10.2-resampling-methods.html#monte-carlo-cross-validation">Monte Carlo cross-validation</a></li>
<li><a href="10.2-resampling-methods.html#validation"><span class="toc-section-number">10.2.2</span> Validation sets</a></li>
<li><a href="10.2-resampling-methods.html#bootstrap"><span class="toc-section-number">10.2.3</span> Bootstrapping</a></li>
<li><a href="10.2-resampling-methods.html#rolling"><span class="toc-section-number">10.2.4</span> Rolling forecasting origin resampling</a></li>
</ul></li>
<li><a href="10.3-resampling-performance.html#resampling-performance"><span class="toc-section-number">10.3</span> Estimating Performance</a></li>
<li><a href="10.4-parallel.html#parallel"><span class="toc-section-number">10.4</span> Parallel Processing</a></li>
<li><a href="10.5-extract.html#extract"><span class="toc-section-number">10.5</span> Saving the Resampled Objects</a></li>
<li><a href="10.6-resampling-summary.html#resampling-summary"><span class="toc-section-number">10.6</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="11-compare.html#compare"><span class="toc-section-number">11</span> Comparing Models with Resampling</a>
<ul>
<li><a href="11.1-workflow-set.html#workflow-set"><span class="toc-section-number">11.1</span> Creating Multiple Models with Workflow Sets</a></li>
<li><a href="11.2-resampled-stats.html#resampled-stats"><span class="toc-section-number">11.2</span> Comparing Resampled Performance Statistics</a></li>
<li><a href="11.3-simple-hypothesis-testing-methods.html#simple-hypothesis-testing-methods"><span class="toc-section-number">11.3</span> Simple Hypothesis Testing Methods</a></li>
<li class="has-sub"><a href="11.4-tidyposterior.html#tidyposterior"><span class="toc-section-number">11.4</span> Bayesian Methods</a>
<ul>
<li><a href="11.4-tidyposterior.html#the-effect-of-the-amount-of-resampling">The effect of the amount of resampling</a></li>
</ul></li>
<li><a href="11.5-compare-summary.html#compare-summary"><span class="toc-section-number">11.5</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="12-tuning.html#tuning"><span class="toc-section-number">12</span> Model Tuning and the Dangers of Overfitting</a>
<ul>
<li><a href="12.1-model-parameters.html#model-parameters"><span class="toc-section-number">12.1</span> Model Parameters</a></li>
<li><a href="12.2-tuning-parameter-examples.html#tuning-parameter-examples"><span class="toc-section-number">12.2</span> Tuning Parameters for Different Types of Models</a></li>
<li><a href="12.3-what-to-optimize.html#what-to-optimize"><span class="toc-section-number">12.3</span> What do we Optimize?</a></li>
<li><a href="12.4-overfitting-bad.html#overfitting-bad"><span class="toc-section-number">12.4</span> The consequences of poor parameter estimates</a></li>
<li><a href="12.5-two-general-strategies-for-optimization.html#two-general-strategies-for-optimization"><span class="toc-section-number">12.5</span> Two general strategies for optimization</a></li>
<li><a href="12.6-tuning-params-tidymodels.html#tuning-params-tidymodels"><span class="toc-section-number">12.6</span> Tuning Parameters in tidymodels</a></li>
<li><a href="12.7-chapter-summary-2.html#chapter-summary-2"><span class="toc-section-number">12.7</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="13-grid-search.html#grid-search"><span class="toc-section-number">13</span> Grid Search</a>
<ul>
<li class="has-sub"><a href="13.1-grids.html#grids"><span class="toc-section-number">13.1</span> Regular and Non-Regular Grids</a>
<ul>
<li><a href="13.1-grids.html#regular-grids">Regular grids</a></li>
<li><a href="13.1-grids.html#irregular-grids">Irregular grids</a></li>
</ul></li>
<li><a href="13.2-evaluating-grid.html#evaluating-grid"><span class="toc-section-number">13.2</span> Evaluating the Grid</a></li>
<li><a href="13.3-finalizing-the-model.html#finalizing-the-model"><span class="toc-section-number">13.3</span> Finalizing the Model</a></li>
<li><a href="13.4-tuning-usemodels.html#tuning-usemodels"><span class="toc-section-number">13.4</span> Tools for Creating Tuning Specifications</a></li>
<li class="has-sub"><a href="13.5-efficient-grids.html#efficient-grids"><span class="toc-section-number">13.5</span> Tools for Efficient Grid Search</a>
<ul>
<li><a href="13.5-efficient-grids.html#submodel-trick"><span class="toc-section-number">13.5.1</span> Submodel optimization</a></li>
<li><a href="13.5-efficient-grids.html#parallel-processing"><span class="toc-section-number">13.5.2</span> Parallel processing</a></li>
<li><a href="13.5-efficient-grids.html#benchmarking-boosted-trees"><span class="toc-section-number">13.5.3</span> Benchmarking boosted trees</a></li>
<li><a href="13.5-efficient-grids.html#access-to-global-variables"><span class="toc-section-number">13.5.4</span> Access to global variables</a></li>
<li><a href="13.5-efficient-grids.html#racing"><span class="toc-section-number">13.5.5</span> Racing methods</a></li>
</ul></li>
<li><a href="13.6-grid-summary.html#grid-summary"><span class="toc-section-number">13.6</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="14-iterative-search.html#iterative-search"><span class="toc-section-number">14</span> Iterative Search</a>
<ul>
<li><a href="14.1-svm.html#svm"><span class="toc-section-number">14.1</span> A Support Vector Machine Model</a></li>
<li class="has-sub"><a href="14.2-bayesian-optimization.html#bayesian-optimization"><span class="toc-section-number">14.2</span> Bayesian Optimization</a>
<ul>
<li><a href="14.2-bayesian-optimization.html#a-gaussian-process-model"><span class="toc-section-number">14.2.1</span> A Gaussian process model</a></li>
<li><a href="14.2-bayesian-optimization.html#acquisition-functions"><span class="toc-section-number">14.2.2</span> Acquisition functions</a></li>
<li><a href="14.2-bayesian-optimization.html#tune-bayes"><span class="toc-section-number">14.2.3</span> The <code>tune_bayes()</code> function</a></li>
</ul></li>
<li class="has-sub"><a href="14.3-simulated-annealing.html#simulated-annealing"><span class="toc-section-number">14.3</span> Simulated Annealing</a>
<ul>
<li><a href="14.3-simulated-annealing.html#simulated-annealing-search-process"><span class="toc-section-number">14.3.1</span> Simulated annealing search process</a></li>
<li><a href="14.3-simulated-annealing.html#tune-sim-anneal"><span class="toc-section-number">14.3.2</span> The <code>tune_sim_anneal()</code> function</a></li>
</ul></li>
<li><a href="14.4-iterative-summary.html#iterative-summary"><span class="toc-section-number">14.4</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="15-workflow-sets.html#workflow-sets"><span class="toc-section-number">15</span> Screening Many Models</a>
<ul>
<li><a href="15.1-modeling-concrete-mixture-strength.html#modeling-concrete-mixture-strength"><span class="toc-section-number">15.1</span> Modeling Concrete Mixture Strength</a></li>
<li><a href="15.2-creating-the-workflow-set.html#creating-the-workflow-set"><span class="toc-section-number">15.2</span> Creating the Workflow Set</a></li>
<li><a href="15.3-tuning-and-evaluating-the-models.html#tuning-and-evaluating-the-models"><span class="toc-section-number">15.3</span> Tuning and Evaluating the Models</a></li>
<li><a href="15.4-racing-example.html#racing-example"><span class="toc-section-number">15.4</span> Efficiently Screening Models</a></li>
<li><a href="15.5-finalizing-a-model.html#finalizing-a-model"><span class="toc-section-number">15.5</span> Finalizing a Model</a></li>
<li><a href="15.6-workflow-sets-summary.html#workflow-sets-summary"><span class="toc-section-number">15.6</span> Chapter Summary</a></li>
</ul></li>
<li class="part"><span><b>Beyond the Basics</b></span></li>
<li class="has-sub"><a href="16-dimensionality.html#dimensionality"><span class="toc-section-number">16</span> Dimensionality Reduction</a>
<ul>
<li><a href="16.1-when-problems-can-dimensionality-reduction-solve.html#when-problems-can-dimensionality-reduction-solve"><span class="toc-section-number">16.1</span> When Problems Can Dimensionality Reduction Solve?</a></li>
<li><a href="16.2-beans.html#beans"><span class="toc-section-number">16.2</span> A Picture is Worth a Thousand… Beans</a></li>
<li><a href="16.3-a-starter-recipe.html#a-starter-recipe"><span class="toc-section-number">16.3</span> A Starter Recipe</a></li>
<li class="has-sub"><a href="16.4-recipe-functions.html#recipe-functions"><span class="toc-section-number">16.4</span> Recipes in the Wild</a>
<ul>
<li><a href="16.4-recipe-functions.html#prep"><span class="toc-section-number">16.4.1</span> Preparing a recipe</a></li>
<li><a href="16.4-recipe-functions.html#bake"><span class="toc-section-number">16.4.2</span> Baking the recipe</a></li>
</ul></li>
<li class="has-sub"><a href="16.5-feature-extraction-techniques.html#feature-extraction-techniques"><span class="toc-section-number">16.5</span> Feature Extraction Techniques</a>
<ul>
<li><a href="16.5-feature-extraction-techniques.html#principal-component-analysis"><span class="toc-section-number">16.5.1</span> Principal component analysis</a></li>
<li><a href="16.5-feature-extraction-techniques.html#partial-least-squares"><span class="toc-section-number">16.5.2</span> Partial least squares</a></li>
<li><a href="16.5-feature-extraction-techniques.html#independent-component-analysis"><span class="toc-section-number">16.5.3</span> Independent component analysis</a></li>
<li><a href="16.5-feature-extraction-techniques.html#uniform-manifold-approximation-and-projection"><span class="toc-section-number">16.5.4</span> Uniform manifold approximation and projection</a></li>
</ul></li>
<li><a href="16.6-bean-models.html#bean-models"><span class="toc-section-number">16.6</span> Modeling</a></li>
<li><a href="16.7-dimensionality-summary.html#dimensionality-summary"><span class="toc-section-number">16.7</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="17-categorical.html#categorical"><span class="toc-section-number">17</span> Encoding Categorical Data</a>
<ul>
<li><a href="17.1-is-an-encoding-necessary.html#is-an-encoding-necessary"><span class="toc-section-number">17.1</span> Is an Encoding Necessary?</a></li>
<li><a href="17.2-encoding-ordinal-predictors.html#encoding-ordinal-predictors"><span class="toc-section-number">17.2</span> Encoding Ordinal Predictors</a></li>
<li class="has-sub"><a href="17.3-using-the-outcome-for-encoding-predictors.html#using-the-outcome-for-encoding-predictors"><span class="toc-section-number">17.3</span> Using the Outcome for Encoding Predictors</a>
<ul>
<li><a href="17.3-using-the-outcome-for-encoding-predictors.html#effect-encodings-with-partial-pooling"><span class="toc-section-number">17.3.1</span> Effect encodings with partial pooling</a></li>
</ul></li>
<li><a href="17.4-feature-hashing.html#feature-hashing"><span class="toc-section-number">17.4</span> Feature Hashing</a></li>
<li><a href="17.5-more-encoding-options.html#more-encoding-options"><span class="toc-section-number">17.5</span> More Encoding Options</a></li>
<li><a href="17.6-categorical-summary.html#categorical-summary"><span class="toc-section-number">17.6</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="18-explain.html#explain"><span class="toc-section-number">18</span> Explaining Models and Predictions</a>
<ul>
<li><a href="18.1-software-for-model-explanations.html#software-for-model-explanations"><span class="toc-section-number">18.1</span> Software for Model Explanations</a></li>
<li><a href="18.2-local-explanations.html#local-explanations"><span class="toc-section-number">18.2</span> Local Explanations</a></li>
<li><a href="18.3-global-explanations.html#global-explanations"><span class="toc-section-number">18.3</span> Global Explanations</a></li>
<li><a href="18.4-building-global-explanations-from-local-explanations.html#building-global-explanations-from-local-explanations"><span class="toc-section-number">18.4</span> Building Global Explanations from Local Explanations</a></li>
<li><a href="18.5-back-to-beans.html#back-to-beans"><span class="toc-section-number">18.5</span> Back to Beans!</a></li>
<li><a href="18.6-explain-summary.html#explain-summary"><span class="toc-section-number">18.6</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="19-trust.html#trust"><span class="toc-section-number">19</span> When Should You Trust Your Predictions?</a>
<ul>
<li><a href="19.1-equivocal-zones.html#equivocal-zones"><span class="toc-section-number">19.1</span> Equivocal Results</a></li>
<li><a href="19.2-applicability-domains.html#applicability-domains"><span class="toc-section-number">19.2</span> Determining Model Applicability</a></li>
<li><a href="19.3-trust-summary.html#trust-summary"><span class="toc-section-number">19.3</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="20-ensembles.html#ensembles"><span class="toc-section-number">20</span> Ensembles of Models</a>
<ul>
<li><a href="20.1-data-stack.html#data-stack"><span class="toc-section-number">20.1</span> Creating the Training Set for Stacking</a></li>
<li><a href="20.2-blend-predictions.html#blend-predictions"><span class="toc-section-number">20.2</span> Blend the Predictions</a></li>
<li><a href="20.3-fit-members.html#fit-members"><span class="toc-section-number">20.3</span> Fit the Member Models</a></li>
<li><a href="20.4-test-set-results.html#test-set-results"><span class="toc-section-number">20.4</span> Test Set Results</a></li>
<li><a href="20.5-ensembles-summary.html#ensembles-summary"><span class="toc-section-number">20.5</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="21-inferential.html#inferential"><span class="toc-section-number">21</span> Inferential Analysis</a>
<ul>
<li><a href="21.1-inference-for-count-data.html#inference-for-count-data"><span class="toc-section-number">21.1</span> Inference for Count Data</a></li>
<li><a href="21.2-comparisons-with-two-sample-tests.html#comparisons-with-two-sample-tests"><span class="toc-section-number">21.2</span> Comparisons with Two-Sample Tests</a></li>
<li><a href="21.3-log-linear-models.html#log-linear-models"><span class="toc-section-number">21.3</span> Log-Linear Models</a></li>
<li><a href="21.4-a-more-complex-model.html#a-more-complex-model"><span class="toc-section-number">21.4</span> A More Complex Model</a></li>
<li><a href="21.5-inference-options.html#inference-options"><span class="toc-section-number">21.5</span> More Inferential Analysis</a></li>
<li><a href="21.6-inference-summary.html#inference-summary"><span class="toc-section-number">21.6</span> Chapter Summary</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li><a href="A-pre-proc-table.html#pre-proc-table"><span class="toc-section-number">A</span> Recommended Preprocessing</a></li>
<li><a href="references.html#references">REFERENCES</a></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="an-example" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> An Example</h2>
<p>To demonstrate some fundamentals for modeling in base R, let’s use experimental data from <span class="citation">McDonald (<a href="#ref-mcdonald2009" role="doc-biblioref">2009</a>)</span>, by way of <span class="citation">Mangiafico (<a href="#ref-mangiafico2015" role="doc-biblioref">2015</a>)</span>, on the relationship between the ambient temperature and the rate of cricket chirps per minute. Data were collected for two species: <em>O. exclamationis</em> and <em>O. niveus</em>. The data are contained in a data frame called <code>crickets</code> with a total of 31 data points. These data are shown in Figure <a href="3.1-an-example.html#fig:cricket-plot">3.1</a> using the following <span class="pkg">ggplot2</span> code.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="3.1-an-example.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb19-2"><a href="3.1-an-example.html#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="3.1-an-example.html#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(crickets, <span class="at">package =</span> <span class="st">&quot;modeldata&quot;</span>)</span>
<span id="cb19-4"><a href="3.1-an-example.html#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(crickets)</span>
<span id="cb19-5"><a href="3.1-an-example.html#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="3.1-an-example.html#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the temperature on the x-axis, the chirp rate on the y-axis. The plot</span></span>
<span id="cb19-7"><a href="3.1-an-example.html#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co"># elements will be colored differently for each species:</span></span>
<span id="cb19-8"><a href="3.1-an-example.html#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(crickets, </span>
<span id="cb19-9"><a href="3.1-an-example.html#cb19-9" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> temp, <span class="at">y =</span> rate, <span class="at">color =</span> species, <span class="at">pch =</span> species, <span class="at">lty =</span> species)) <span class="sc">+</span> </span>
<span id="cb19-10"><a href="3.1-an-example.html#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Plot points for each data point and color by species</span></span>
<span id="cb19-11"><a href="3.1-an-example.html#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb19-12"><a href="3.1-an-example.html#cb19-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Show a simple linear model fit created separately for each species:</span></span>
<span id="cb19-13"><a href="3.1-an-example.html#cb19-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> lm, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb19-14"><a href="3.1-an-example.html#cb19-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Paired&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-15"><a href="3.1-an-example.html#cb19-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Temperature (C)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Chirp Rate (per minute)&quot;</span>)</span></code></pre></div>
<pre><code>#&gt; [1] &quot;species&quot; &quot;temp&quot;    &quot;rate&quot;</code></pre>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:cricket-plot"></span>
<img src="figures/cricket-plot-1.png" alt="A scatter plot of the chirp rate and temperature for two different species of cricket with linear trend lines per species. The trends are linearly increasing with a separation between the two species." width="70%" />
<p class="caption">
Figure 3.1: Relationship between chirp rate and temperature for two different species of cricket.
</p>
</div>
<p>The data exhibit fairly linear trends for each species. For a given temperature, <em>O. exclamationis</em> appears to chirp more per minute than the other species. For an inferential model, the researchers might have specified the following null hypotheses prior to seeing the data:</p>
<ul>
<li><p>Temperature has no effect on the chirp rate.</p></li>
<li><p>There are no differences between the species’ chirp rate.</p></li>
</ul>
<p>There may be some scientific or practical value in predicting the chirp rate but in this example we will focus on inference.</p>
<p>To fit an ordinary linear model in R, the <code>lm()</code> function is commonly used. The important arguments to this function are a model formula and a data frame that contains the data. The formula is <em>symbolic</em>. For example, the simple formula:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="3.1-an-example.html#cb21-1" aria-hidden="true" tabindex="-1"></a>rate <span class="sc">~</span> temp</span></code></pre></div>
<p>specifies that the chirp rate is the outcome (since it is on the left-hand side of the tilde <code>~</code>) and that the temperature value is the predictor.<a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a> Suppose the data contained the time of day in which the measurements were obtained in a column called <code>time</code>. The formula:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="3.1-an-example.html#cb22-1" aria-hidden="true" tabindex="-1"></a>rate <span class="sc">~</span> temp <span class="sc">+</span> time</span></code></pre></div>
<p>would not add the time and temperature values together. This formula would symbolically represent that temperature and time should be added as separate <em>main effects</em> to the model. A main effect is a model term that contains a single predictor variable.</p>
<p>There are no time measurements in these data but the species can be added to the model in the same way:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="3.1-an-example.html#cb23-1" aria-hidden="true" tabindex="-1"></a>rate <span class="sc">~</span> temp <span class="sc">+</span> species</span></code></pre></div>
<p>Species is not a quantitative variable; in the data frame, it is represented as a factor column with levels <code>"O. exclamationis"</code> and <code>"O. niveus"</code>. The vast majority of model functions cannot operate on non-numeric data. For species, the model needs to encode the species data in a numeric format. The most common approach is to use indicator variables (also known as “dummy variables”) in place of the original qualitative values. In this instance, since species has two possible values, the model formula will automatically encode this column as numeric by adding a new column that has a value of zero when the species is <code>"O. exclamationis"</code> and a value of one when the data correspond to <code>"O. niveus"</code>. The underlying formula machinery automatically converts these values for the data set used to create the model, as well as for any new data points (for example, when the model is used for prediction).</p>
<div class="rmdnote">
<p>Suppose there were five species instead of two. The model formula would automatically add four additional binary columns that are binary indicators for four of the species. The <em>reference level</em> of the factor (i.e., the first level) is always left out of the predictor set. The idea is that, if you know the values of the four indicator variables, the value of the species can be determined. We discuss binary indicator variables in more detail in Chapter <a href="8-recipes.html#recipes">8</a>.</p>
</div>
<p>The model formula <code>rate ~ temp + species</code> creates a model with different y-intercepts for each species; the slopes of the regression lines could be different for each species as well. To accommodate this structure, an interaction term can be added to the model. This can be specified in a few different ways, and the most basic uses the colon:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="3.1-an-example.html#cb24-1" aria-hidden="true" tabindex="-1"></a>rate <span class="sc">~</span> temp <span class="sc">+</span> species <span class="sc">+</span> temp<span class="sc">:</span>species</span>
<span id="cb24-2"><a href="3.1-an-example.html#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="3.1-an-example.html#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co"># A shortcut can be used to expand all interactions containing</span></span>
<span id="cb24-4"><a href="3.1-an-example.html#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># interactions with two variables:</span></span>
<span id="cb24-5"><a href="3.1-an-example.html#cb24-5" aria-hidden="true" tabindex="-1"></a>rate <span class="sc">~</span> (temp <span class="sc">+</span> species)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb24-6"><a href="3.1-an-example.html#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="3.1-an-example.html#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Another shortcut to expand factors to include all possible</span></span>
<span id="cb24-8"><a href="3.1-an-example.html#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="co"># interactions (equivalent for this example):</span></span>
<span id="cb24-9"><a href="3.1-an-example.html#cb24-9" aria-hidden="true" tabindex="-1"></a>rate <span class="sc">~</span> temp <span class="sc">*</span> species</span></code></pre></div>
<p>In addition to the convenience of automatically creating indicator variables, the formula offers a few other niceties:</p>
<ul>
<li><p><em>In-line</em> functions can be used in the formula. For example, to use the natural log of the temperature, we can create the formula <code>rate ~ log(temp)</code>. Since the formula is symbolic by default, literal math can also be applied to the predictors using the identity function <code>I()</code>. To use Fahrenheit units, the formula could be <code>rate ~ I( (temp * 9/5) + 32 )</code> to convert from Celsius.</p></li>
<li><p>R has many functions that are useful inside of formulas. For example, <code>poly(x, 3)</code> creates linear, quadratic, and cubic terms for <code>x</code> to the model as main effects. The <span class="pkg">splines</span> package also has several functions to create nonlinear spline terms in the formula.</p></li>
<li><p>For data sets where there are many predictors, the period shortcut is available. The period represents main effects for all of the columns that are not on the left-hand side of the tilde. Using <code>~ (.)^3</code> would create main effects as well as all two- and three-variable interactions to the model.</p></li>
</ul>
<p>Returning to our chirping crickets, let’s use a two-way interaction model. In this book, we use the suffix <code>_fit</code> for R objects that are fitted models.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="3.1-an-example.html#cb25-1" aria-hidden="true" tabindex="-1"></a>interaction_fit <span class="ot">&lt;-</span>  <span class="fu">lm</span>(rate <span class="sc">~</span> (temp <span class="sc">+</span> species)<span class="sc">^</span><span class="dv">2</span>, <span class="at">data =</span> crickets) </span>
<span id="cb25-2"><a href="3.1-an-example.html#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="3.1-an-example.html#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co"># To print a short summary of the model:</span></span>
<span id="cb25-4"><a href="3.1-an-example.html#cb25-4" aria-hidden="true" tabindex="-1"></a>interaction_fit</span>
<span id="cb25-5"><a href="3.1-an-example.html#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb25-6"><a href="3.1-an-example.html#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Call:</span></span>
<span id="cb25-7"><a href="3.1-an-example.html#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; lm(formula = rate ~ (temp + species)^2, data = crickets)</span></span>
<span id="cb25-8"><a href="3.1-an-example.html#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb25-9"><a href="3.1-an-example.html#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb25-10"><a href="3.1-an-example.html#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;           (Intercept)                   temp       speciesO. niveus  </span></span>
<span id="cb25-11"><a href="3.1-an-example.html#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;               -11.041                  3.751                 -4.348  </span></span>
<span id="cb25-12"><a href="3.1-an-example.html#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; temp:speciesO. niveus  </span></span>
<span id="cb25-13"><a href="3.1-an-example.html#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                -0.234</span></span></code></pre></div>
<p>This output is a little hard to read. For the species indicator variables, R mashes the variable name (<code>species</code>) together with the factor level (<code>O. niveus</code>) with no delimiter.</p>
<p>Before going into any inferential results for this model, the fit should be assessed using diagnostic plots. We can use the <code>plot()</code> method for <code>lm</code> objects. This method produces a set of four plots for the object, each showing different aspects of the fit, as shown in Figure <a href="3.1-an-example.html#fig:interaction-plots">3.2</a>.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="3.1-an-example.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Place two plots next to one another:</span></span>
<span id="cb26-2"><a href="3.1-an-example.html#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb26-3"><a href="3.1-an-example.html#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="3.1-an-example.html#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Show residuals vs predicted values:</span></span>
<span id="cb26-5"><a href="3.1-an-example.html#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(interaction_fit, <span class="at">which =</span> <span class="dv">1</span>)</span>
<span id="cb26-6"><a href="3.1-an-example.html#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="3.1-an-example.html#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co"># A normal quantile plot on the residuals:</span></span>
<span id="cb26-8"><a href="3.1-an-example.html#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(interaction_fit, <span class="at">which =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:interaction-plots"></span>
<img src="figures/interaction-plots-1.png" alt="On the left is a scatter plot of the model residuals versus predicted values. There are no strong trends in the data. The right-hand panel shows a normal quantile-quantile plot where the points indicate that normality is probably a good assumption." width="100%" />
<p class="caption">
Figure 3.2: Residual diagnostic plots for the linear model with interactions, which appear reasonable enough to conduct inferential analysis.
</p>
</div>
<div class="rmdnote">
<p>When it comes to the technical details of evaluating expressions, R is <em>lazy</em> (as opposed to eager). This means that model fitting functions typically compute the minimum possible quantities at the last possible moment. For example, if you are interested in the coefficient table for each model term, this is not automatically computed with the model but is instead computed via the <code>summary()</code> method.</p>
</div>
<p>Our next order of business with the crickets is to assess if the inclusion of the interaction term is necessary. The most appropriate approach for this model is to re-compute the model without the interaction term and use the <code>anova()</code> method.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="3.1-an-example.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit a reduced model:</span></span>
<span id="cb27-2"><a href="3.1-an-example.html#cb27-2" aria-hidden="true" tabindex="-1"></a>main_effect_fit <span class="ot">&lt;-</span>  <span class="fu">lm</span>(rate <span class="sc">~</span> temp <span class="sc">+</span> species, <span class="at">data =</span> crickets) </span>
<span id="cb27-3"><a href="3.1-an-example.html#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="3.1-an-example.html#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare the two:</span></span>
<span id="cb27-5"><a href="3.1-an-example.html#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(main_effect_fit, interaction_fit)</span>
<span id="cb27-6"><a href="3.1-an-example.html#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Analysis of Variance Table</span></span>
<span id="cb27-7"><a href="3.1-an-example.html#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb27-8"><a href="3.1-an-example.html#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Model 1: rate ~ temp + species</span></span>
<span id="cb27-9"><a href="3.1-an-example.html#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Model 2: rate ~ (temp + species)^2</span></span>
<span id="cb27-10"><a href="3.1-an-example.html#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Res.Df  RSS Df Sum of Sq    F Pr(&gt;F)</span></span>
<span id="cb27-11"><a href="3.1-an-example.html#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     28 89.3                         </span></span>
<span id="cb27-12"><a href="3.1-an-example.html#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2     27 85.1  1      4.28 1.36   0.25</span></span></code></pre></div>
<p>This statistical test generates a p-value of 0.25. This implies that there is a lack of evidence against the null hypothesis that the interaction term is not needed by the model. For this reason, we will conduct further analysis on the model without the interaction.</p>
<p>Residual plots should be re-assessed to make sure that our theoretical assumptions are valid enough to trust the p-values produced by the model (plots not shown here but spoiler alert: they are).</p>
<p>We can use the <code>summary()</code> method to inspect the coefficients, standard errors, and p-values of each model term:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="3.1-an-example.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(main_effect_fit)</span>
<span id="cb28-2"><a href="3.1-an-example.html#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb28-3"><a href="3.1-an-example.html#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Call:</span></span>
<span id="cb28-4"><a href="3.1-an-example.html#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; lm(formula = rate ~ temp + species, data = crickets)</span></span>
<span id="cb28-5"><a href="3.1-an-example.html#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb28-6"><a href="3.1-an-example.html#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Residuals:</span></span>
<span id="cb28-7"><a href="3.1-an-example.html#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    Min     1Q Median     3Q    Max </span></span>
<span id="cb28-8"><a href="3.1-an-example.html#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; -3.013 -1.130 -0.391  0.965  3.780 </span></span>
<span id="cb28-9"><a href="3.1-an-example.html#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb28-10"><a href="3.1-an-example.html#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb28-11"><a href="3.1-an-example.html#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                  Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span id="cb28-12"><a href="3.1-an-example.html#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; (Intercept)       -7.2109     2.5509   -2.83   0.0086 ** </span></span>
<span id="cb28-13"><a href="3.1-an-example.html#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; temp               3.6028     0.0973   37.03  &lt; 2e-16 ***</span></span>
<span id="cb28-14"><a href="3.1-an-example.html#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; speciesO. niveus -10.0653     0.7353  -13.69  6.3e-14 ***</span></span>
<span id="cb28-15"><a href="3.1-an-example.html#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ---</span></span>
<span id="cb28-16"><a href="3.1-an-example.html#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb28-17"><a href="3.1-an-example.html#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb28-18"><a href="3.1-an-example.html#cb28-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Residual standard error: 1.79 on 28 degrees of freedom</span></span>
<span id="cb28-19"><a href="3.1-an-example.html#cb28-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Multiple R-squared:  0.99,   Adjusted R-squared:  0.989 </span></span>
<span id="cb28-20"><a href="3.1-an-example.html#cb28-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; F-statistic: 1.33e+03 on 2 and 28 DF,  p-value: &lt;2e-16</span></span></code></pre></div>
<p>The chirp rate for each species increases by 3.6 chirps as the temperature increases by a single degree. This term shows strong statistical significance as evidenced by the p-value. The species term has a value of -10.07. This indicates that, across all temperature values, <em>O. niveus</em> has a chirp rate that is about 10 fewer chirps per minute than <em>O. exclamationis</em>. Similar to the temperature term, the species effect is associated with a very small p-value.</p>
<p>The only issue in this analysis is the intercept value. It indicates that at 0 C, there are negative chirps per minute for both species. While this doesn’t make sense, the data only go as low as 17.2 C and interpreting the model at 0 C would be an extrapolation. This would be a bad idea. That being said, the model fit is good within the <em>applicable range</em> of the temperature values; the conclusions should be limited to the observed temperature range.</p>
<p>If we needed to estimate the chirp rate at a temperature that was not observed in the experiment, we could use the <code>predict()</code> method. It takes the model object and a data frame of new values for prediction. For example, the model estimates the chirp rate for <em>O. exclamationis</em> for temperatures between 15 C and 20 C can be computed via:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="3.1-an-example.html#cb29-1" aria-hidden="true" tabindex="-1"></a>new_values <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">species =</span> <span class="st">&quot;O. exclamationis&quot;</span>, <span class="at">temp =</span> <span class="dv">15</span><span class="sc">:</span><span class="dv">20</span>)</span>
<span id="cb29-2"><a href="3.1-an-example.html#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(main_effect_fit, new_values)</span>
<span id="cb29-3"><a href="3.1-an-example.html#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     1     2     3     4     5     6 </span></span>
<span id="cb29-4"><a href="3.1-an-example.html#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 46.83 50.43 54.04 57.64 61.24 64.84</span></span></code></pre></div>
<div class="rmdwarning">
<p>Note that the non-numeric value of <code>species</code> is passed to the predict method, as opposed to the numeric, binary indicator variable.</p>
</div>
<p>While this analysis has obviously not been an exhaustive demonstration of R’s modeling capabilities, it does highlight some major features important for the rest of this book:</p>
<ul>
<li><p>The language has an expressive syntax for specifying model terms for both simple and quite complex models.</p></li>
<li><p>The R formula method has many conveniences for modeling that are also applied to new data when predictions are generated.</p></li>
<li><p>There are numerous helper functions (e.g., <code>anova()</code>, <code>summary()</code> and <code>predict()</code>) that you can use to conduct specific calculations after the fitted model is created.</p></li>
</ul>
<p>Finally, as previously mentioned, this framework was first published in 1992. Most of these ideas and methods were developed in that period but have remained remarkably relevant to this day. It highlights that the S language and, by extension R, has been designed for data analysis since its inception.</p>
</div>
<h3>REFERENCES</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-mangiafico2015" class="csl-entry">
Mangiafico, S. 2015. <span>“An <span>R</span> Companion for the Handbook of Biological Statistics.”</span> <a href="https://rcompanion.org/handbook/" class="uri">https://rcompanion.org/handbook/</a>.
</div>
<div id="ref-mcdonald2009" class="csl-entry">
McDonald, J. 2009. <em>Handbook of Biological Statistics</em>. Sparky House Publishing.
</div>
</div>
<div class="footnotes">
<hr />
<ol start="8">
<li id="fn8"><p>Most model functions implicitly add an intercept column.<a href="3.1-an-example.html#fnref8" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
<p style="text-align: center;">
<a href="3-base-r.html"><button class="btn btn-default">Previous</button></a>
<a href="3.2-formula.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

</body>
</html>
