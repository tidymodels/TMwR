<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="21.4 A More Complex Model | Tidy Modeling with R" />
<meta property="og:type" content="book" />
<meta property="og:image" content="/images/cover.png" />
<meta property="og:description" content="The tidymodels framework is a collection of R packages for modeling and machine learning using tidyverse principles. This book provides a thorough introduction to how to use tidymodels, and an outline of good methodology and statistical practice for phases of the modeling process." />
<meta name="github-repo" content="tidymodels/TMwR" />

<meta name="author" content="Max Kuhn and Julia Silge" />


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta name="description" content="The tidymodels framework is a collection of R packages for modeling and machine learning using tidyverse principles. This book provides a thorough introduction to how to use tidymodels, and an outline of good methodology and statistical practice for phases of the modeling process.">

<title>21.4 A More Complex Model | Tidy Modeling with R</title>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="libs/navigation-1.1/tabsets.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
/* show arrow before summary tag as in bootstrap
TODO: remove if boostrap in updated in html_document (rmarkdown#1485) */
details > summary {
  display: list-item;
  cursor: pointer;
}
</style>
</head>

<body>

<div class="container-fluid main-container">


<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li class="has-sub"><a href="index.html#hello-world">Hello World</a>
<ul>
<li><a href="acknowledgments.html#acknowledgments">Acknowledgments</a></li>
<li><a href="using-code-examples.html#using-code-examples">Using Code Examples</a></li>
</ul></li>
<li class="part"><span><b>Introduction</b></span></li>
<li class="has-sub"><a href="1-software-modeling.html#software-modeling"><span class="toc-section-number">1</span> Software for modeling</a>
<ul>
<li><a href="1.1-fundamentals-for-modeling-software.html#fundamentals-for-modeling-software"><span class="toc-section-number">1.1</span> Fundamentals for Modeling Software</a></li>
<li class="has-sub"><a href="1.2-model-types.html#model-types"><span class="toc-section-number">1.2</span> Types of Models</a>
<ul>
<li><a href="1.2-model-types.html#descriptive-models">Descriptive models</a></li>
<li><a href="1.2-model-types.html#inferential-models">Inferential models</a></li>
<li><a href="1.2-model-types.html#predictive-models">Predictive models</a></li>
</ul></li>
<li><a href="1.3-connections-between-types-of-models.html#connections-between-types-of-models"><span class="toc-section-number">1.3</span> Connections Between Types of Models</a></li>
<li><a href="1.4-model-terminology.html#model-terminology"><span class="toc-section-number">1.4</span> Some Terminology</a></li>
<li><a href="1.5-model-phases.html#model-phases"><span class="toc-section-number">1.5</span> How Does Modeling Fit into the Data Analysis Process?</a></li>
<li><a href="1.6-software-summary.html#software-summary"><span class="toc-section-number">1.6</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="2-tidyverse.html#tidyverse"><span class="toc-section-number">2</span> A Tidyverse Primer</a>
<ul>
<li class="has-sub"><a href="2.1-tidyverse-principles.html#tidyverse-principles"><span class="toc-section-number">2.1</span> Tidyverse Principles</a>
<ul>
<li><a href="2.1-tidyverse-principles.html#design-for-humans"><span class="toc-section-number">2.1.1</span> Design for humans</a></li>
<li><a href="2.1-tidyverse-principles.html#reuse-existing-data-structures"><span class="toc-section-number">2.1.2</span> Reuse existing data structures</a></li>
<li><a href="2.1-tidyverse-principles.html#design-for-the-pipe-and-functional-programming"><span class="toc-section-number">2.1.3</span> Design for the pipe and functional programming</a></li>
</ul></li>
<li><a href="2.2-examples-of-tidyverse-syntax.html#examples-of-tidyverse-syntax"><span class="toc-section-number">2.2</span> Examples of Tidyverse Syntax</a></li>
<li><a href="2.3-chapter-summary.html#chapter-summary"><span class="toc-section-number">2.3</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="3-base-r.html#base-r"><span class="toc-section-number">3</span> A Review of R Modeling Fundamentals</a>
<ul>
<li><a href="3.1-an-example.html#an-example"><span class="toc-section-number">3.1</span> An Example</a></li>
<li><a href="3.2-formula.html#formula"><span class="toc-section-number">3.2</span> What Does the R Formula Do?</a></li>
<li><a href="3.3-tidiness-modeling.html#tidiness-modeling"><span class="toc-section-number">3.3</span> Why Tidiness is Important for Modeling</a></li>
<li><a href="3.4-combining-base-r-models-and-the-tidyverse.html#combining-base-r-models-and-the-tidyverse"><span class="toc-section-number">3.4</span> Combining Base R Models and the Tidyverse</a></li>
<li><a href="3.5-the-tidymodels-metapackage.html#the-tidymodels-metapackage"><span class="toc-section-number">3.5</span> The tidymodels Metapackage</a></li>
<li><a href="3.6-chapter-summary-1.html#chapter-summary-1"><span class="toc-section-number">3.6</span> Chapter Summary</a></li>
</ul></li>
<li class="part"><span><b>Modeling Basics</b></span></li>
<li class="has-sub"><a href="4-ames.html#ames"><span class="toc-section-number">4</span> The Ames Housing Data</a>
<ul>
<li><a href="4.1-exploring-features-of-homes-in-ames.html#exploring-features-of-homes-in-ames"><span class="toc-section-number">4.1</span> Exploring Features of Homes in Ames</a></li>
<li><a href="4.2-ames-summary.html#ames-summary"><span class="toc-section-number">4.2</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="5-splitting.html#splitting"><span class="toc-section-number">5</span> Spending our Data</a>
<ul>
<li><a href="5.1-splitting-methods.html#splitting-methods"><span class="toc-section-number">5.1</span> Common Methods for Splitting Data</a></li>
<li><a href="5.2-what-about-a-validation-set.html#what-about-a-validation-set"><span class="toc-section-number">5.2</span> What About a Validation Set?</a></li>
<li><a href="5.3-multi-level-data.html#multi-level-data"><span class="toc-section-number">5.3</span> Multi-Level Data</a></li>
<li><a href="5.4-other-considerations-for-a-data-budget.html#other-considerations-for-a-data-budget"><span class="toc-section-number">5.4</span> Other Considerations for a Data Budget</a></li>
<li><a href="5.5-splitting-summary.html#splitting-summary"><span class="toc-section-number">5.5</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="6-models.html#models"><span class="toc-section-number">6</span> Fitting Models with parsnip</a>
<ul>
<li><a href="6.1-create-a-model.html#create-a-model"><span class="toc-section-number">6.1</span> Create a Model</a></li>
<li><a href="6.2-use-the-model-results.html#use-the-model-results"><span class="toc-section-number">6.2</span> Use the Model Results</a></li>
<li><a href="6.3-parsnip-predictions.html#parsnip-predictions"><span class="toc-section-number">6.3</span> Make Predictions</a></li>
<li><a href="6.4-parsnip-extension-packages.html#parsnip-extension-packages"><span class="toc-section-number">6.4</span> parsnip-Extension Packages</a></li>
<li><a href="6.5-parsnip-addin.html#parsnip-addin"><span class="toc-section-number">6.5</span> Creating Model Specifications</a></li>
<li><a href="6.6-models-summary.html#models-summary"><span class="toc-section-number">6.6</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="7-workflows.html#workflows"><span class="toc-section-number">7</span> A Model Workflow</a>
<ul>
<li><a href="7.1-begin-model-end.html#begin-model-end"><span class="toc-section-number">7.1</span> Where Does the Model Begin and End?</a></li>
<li><a href="7.2-workflow-basics.html#workflow-basics"><span class="toc-section-number">7.2</span> Workflow Basics</a></li>
<li><a href="7.3-adding-raw-variables-to-the-workflow.html#adding-raw-variables-to-the-workflow"><span class="toc-section-number">7.3</span> Adding Raw Variables to the <code>workflow()</code></a></li>
<li class="has-sub"><a href="7.4-workflow-encoding.html#workflow-encoding"><span class="toc-section-number">7.4</span> How Does a <code>workflow()</code> Use the Formula?</a>
<ul>
<li><a href="7.4-workflow-encoding.html#tree-based-models">Tree-based models</a></li>
<li><a href="7.4-workflow-encoding.html#special-model-formulas"><span class="toc-section-number">7.4.1</span> Special formulas and in-line functions</a></li>
</ul></li>
<li><a href="7.5-workflow-sets-intro.html#workflow-sets-intro"><span class="toc-section-number">7.5</span> Creating Multiple Workflows at Once</a></li>
<li><a href="7.6-evaluating-the-test-set.html#evaluating-the-test-set"><span class="toc-section-number">7.6</span> Evaluating the Test Set</a></li>
<li><a href="7.7-workflows-summary.html#workflows-summary"><span class="toc-section-number">7.7</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="8-recipes.html#recipes"><span class="toc-section-number">8</span> Feature Engineering with recipes</a>
<ul>
<li><a href="8.1-a-simple-recipe-for-the-ames-housing-data.html#a-simple-recipe-for-the-ames-housing-data"><span class="toc-section-number">8.1</span> A Simple <code>recipe()</code> for the Ames Housing Data</a></li>
<li><a href="8.2-using-recipes.html#using-recipes"><span class="toc-section-number">8.2</span> Using Recipes</a></li>
<li><a href="8.3-how-data-are-used-by-the-recipe.html#how-data-are-used-by-the-recipe"><span class="toc-section-number">8.3</span> How Data are Used by the <code>recipe()</code></a></li>
<li class="has-sub"><a href="8.4-example-steps.html#example-steps"><span class="toc-section-number">8.4</span> Examples of <code>recipe()</code> Steps</a>
<ul>
<li><a href="8.4-example-steps.html#dummies"><span class="toc-section-number">8.4.1</span> Encoding qualitative data in a numeric format</a></li>
<li><a href="8.4-example-steps.html#interaction-terms"><span class="toc-section-number">8.4.2</span> Interaction terms</a></li>
<li><a href="8.4-example-steps.html#spline-functions"><span class="toc-section-number">8.4.3</span> Spline functions</a></li>
<li><a href="8.4-example-steps.html#feature-extraction"><span class="toc-section-number">8.4.4</span> Feature extraction</a></li>
<li><a href="8.4-example-steps.html#row-sampling-steps"><span class="toc-section-number">8.4.5</span> Row sampling steps</a></li>
<li><a href="8.4-example-steps.html#general-transformations"><span class="toc-section-number">8.4.6</span> General transformations</a></li>
<li><a href="8.4-example-steps.html#natural-language-processing"><span class="toc-section-number">8.4.7</span> Natural language processing</a></li>
</ul></li>
<li><a href="8.5-skip-equals-true.html#skip-equals-true"><span class="toc-section-number">8.5</span> Skipping Steps for New Data</a></li>
<li><a href="8.6-tidy-a-recipe.html#tidy-a-recipe"><span class="toc-section-number">8.6</span> Tidy a <code>recipe()</code></a></li>
<li><a href="8.7-column-roles.html#column-roles"><span class="toc-section-number">8.7</span> Column Roles</a></li>
<li><a href="8.8-recipes-summary.html#recipes-summary"><span class="toc-section-number">8.8</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="9-performance.html#performance"><span class="toc-section-number">9</span> Judging Model Effectiveness</a>
<ul>
<li><a href="9.1-performance-metrics-and-inference.html#performance-metrics-and-inference"><span class="toc-section-number">9.1</span> Performance Metrics and Inference</a></li>
<li><a href="9.2-regression-metrics.html#regression-metrics"><span class="toc-section-number">9.2</span> Regression Metrics</a></li>
<li><a href="9.3-binary-classification-metrics.html#binary-classification-metrics"><span class="toc-section-number">9.3</span> Binary Classification Metrics</a></li>
<li><a href="9.4-multi-class-classification-metrics.html#multi-class-classification-metrics"><span class="toc-section-number">9.4</span> Multi-Class Classification Metrics</a></li>
<li><a href="9.5-performance-summary.html#performance-summary"><span class="toc-section-number">9.5</span> Chapter Summary</a></li>
</ul></li>
<li class="part"><span><b>Tools for Creating Effective Models</b></span></li>
<li class="has-sub"><a href="10-resampling.html#resampling"><span class="toc-section-number">10</span> Resampling for Evaluating Performance</a>
<ul>
<li><a href="10.1-resampling-resubstition.html#resampling-resubstition"><span class="toc-section-number">10.1</span> The Resubstitution Approach</a></li>
<li class="has-sub"><a href="10.2-resampling-methods.html#resampling-methods"><span class="toc-section-number">10.2</span> Resampling Methods</a>
<ul>
<li><a href="10.2-resampling-methods.html#cv"><span class="toc-section-number">10.2.1</span> Cross-validation</a></li>
<li><a href="10.2-resampling-methods.html#repeated-cross-validation">Repeated cross-validation</a></li>
<li><a href="10.2-resampling-methods.html#leave-one-out-cross-validation">Leave-one-out cross-validation</a></li>
<li><a href="10.2-resampling-methods.html#monte-carlo-cross-validation">Monte Carlo cross-validation</a></li>
<li><a href="10.2-resampling-methods.html#validation"><span class="toc-section-number">10.2.2</span> Validation sets</a></li>
<li><a href="10.2-resampling-methods.html#bootstrap"><span class="toc-section-number">10.2.3</span> Bootstrapping</a></li>
<li><a href="10.2-resampling-methods.html#rolling"><span class="toc-section-number">10.2.4</span> Rolling forecasting origin resampling</a></li>
</ul></li>
<li><a href="10.3-resampling-performance.html#resampling-performance"><span class="toc-section-number">10.3</span> Estimating Performance</a></li>
<li><a href="10.4-parallel.html#parallel"><span class="toc-section-number">10.4</span> Parallel Processing</a></li>
<li><a href="10.5-extract.html#extract"><span class="toc-section-number">10.5</span> Saving the Resampled Objects</a></li>
<li><a href="10.6-resampling-summary.html#resampling-summary"><span class="toc-section-number">10.6</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="11-compare.html#compare"><span class="toc-section-number">11</span> Comparing Models with Resampling</a>
<ul>
<li><a href="11.1-workflow-set.html#workflow-set"><span class="toc-section-number">11.1</span> Creating Multiple Models with Workflow Sets</a></li>
<li><a href="11.2-resampled-stats.html#resampled-stats"><span class="toc-section-number">11.2</span> Comparing Resampled Performance Statistics</a></li>
<li><a href="11.3-simple-hypothesis-testing-methods.html#simple-hypothesis-testing-methods"><span class="toc-section-number">11.3</span> Simple Hypothesis Testing Methods</a></li>
<li class="has-sub"><a href="11.4-tidyposterior.html#tidyposterior"><span class="toc-section-number">11.4</span> Bayesian Methods</a>
<ul>
<li><a href="11.4-tidyposterior.html#the-effect-of-the-amount-of-resampling">The effect of the amount of resampling</a></li>
</ul></li>
<li><a href="11.5-compare-summary.html#compare-summary"><span class="toc-section-number">11.5</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="12-tuning.html#tuning"><span class="toc-section-number">12</span> Model Tuning and the Dangers of Overfitting</a>
<ul>
<li><a href="12.1-model-parameters.html#model-parameters"><span class="toc-section-number">12.1</span> Model Parameters</a></li>
<li><a href="12.2-tuning-parameter-examples.html#tuning-parameter-examples"><span class="toc-section-number">12.2</span> Tuning Parameters for Different Types of Models</a></li>
<li><a href="12.3-what-to-optimize.html#what-to-optimize"><span class="toc-section-number">12.3</span> What do we Optimize?</a></li>
<li><a href="12.4-overfitting-bad.html#overfitting-bad"><span class="toc-section-number">12.4</span> The consequences of poor parameter estimates</a></li>
<li><a href="12.5-two-general-strategies-for-optimization.html#two-general-strategies-for-optimization"><span class="toc-section-number">12.5</span> Two general strategies for optimization</a></li>
<li><a href="12.6-tuning-params-tidymodels.html#tuning-params-tidymodels"><span class="toc-section-number">12.6</span> Tuning Parameters in tidymodels</a></li>
<li><a href="12.7-chapter-summary-2.html#chapter-summary-2"><span class="toc-section-number">12.7</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="13-grid-search.html#grid-search"><span class="toc-section-number">13</span> Grid Search</a>
<ul>
<li class="has-sub"><a href="13.1-grids.html#grids"><span class="toc-section-number">13.1</span> Regular and Non-Regular Grids</a>
<ul>
<li><a href="13.1-grids.html#regular-grids">Regular grids</a></li>
<li><a href="13.1-grids.html#irregular-grids">Irregular grids</a></li>
</ul></li>
<li><a href="13.2-evaluating-grid.html#evaluating-grid"><span class="toc-section-number">13.2</span> Evaluating the Grid</a></li>
<li><a href="13.3-finalizing-the-model.html#finalizing-the-model"><span class="toc-section-number">13.3</span> Finalizing the Model</a></li>
<li><a href="13.4-tuning-usemodels.html#tuning-usemodels"><span class="toc-section-number">13.4</span> Tools for Creating Tuning Specifications</a></li>
<li class="has-sub"><a href="13.5-efficient-grids.html#efficient-grids"><span class="toc-section-number">13.5</span> Tools for Efficient Grid Search</a>
<ul>
<li><a href="13.5-efficient-grids.html#submodel-trick"><span class="toc-section-number">13.5.1</span> Submodel optimization</a></li>
<li><a href="13.5-efficient-grids.html#parallel-processing"><span class="toc-section-number">13.5.2</span> Parallel processing</a></li>
<li><a href="13.5-efficient-grids.html#benchmarking-boosted-trees"><span class="toc-section-number">13.5.3</span> Benchmarking boosted trees</a></li>
<li><a href="13.5-efficient-grids.html#access-to-global-variables"><span class="toc-section-number">13.5.4</span> Access to global variables</a></li>
<li><a href="13.5-efficient-grids.html#racing"><span class="toc-section-number">13.5.5</span> Racing methods</a></li>
</ul></li>
<li><a href="13.6-grid-summary.html#grid-summary"><span class="toc-section-number">13.6</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="14-iterative-search.html#iterative-search"><span class="toc-section-number">14</span> Iterative Search</a>
<ul>
<li><a href="14.1-svm.html#svm"><span class="toc-section-number">14.1</span> A Support Vector Machine Model</a></li>
<li class="has-sub"><a href="14.2-bayesian-optimization.html#bayesian-optimization"><span class="toc-section-number">14.2</span> Bayesian Optimization</a>
<ul>
<li><a href="14.2-bayesian-optimization.html#a-gaussian-process-model"><span class="toc-section-number">14.2.1</span> A Gaussian process model</a></li>
<li><a href="14.2-bayesian-optimization.html#acquisition-functions"><span class="toc-section-number">14.2.2</span> Acquisition functions</a></li>
<li><a href="14.2-bayesian-optimization.html#tune-bayes"><span class="toc-section-number">14.2.3</span> The <code>tune_bayes()</code> function</a></li>
</ul></li>
<li class="has-sub"><a href="14.3-simulated-annealing.html#simulated-annealing"><span class="toc-section-number">14.3</span> Simulated Annealing</a>
<ul>
<li><a href="14.3-simulated-annealing.html#simulated-annealing-search-process"><span class="toc-section-number">14.3.1</span> Simulated annealing search process</a></li>
<li><a href="14.3-simulated-annealing.html#tune-sim-anneal"><span class="toc-section-number">14.3.2</span> The <code>tune_sim_anneal()</code> function</a></li>
</ul></li>
<li><a href="14.4-iterative-summary.html#iterative-summary"><span class="toc-section-number">14.4</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="15-workflow-sets.html#workflow-sets"><span class="toc-section-number">15</span> Screening Many Models</a>
<ul>
<li><a href="15.1-modeling-concrete-mixture-strength.html#modeling-concrete-mixture-strength"><span class="toc-section-number">15.1</span> Modeling Concrete Mixture Strength</a></li>
<li><a href="15.2-creating-the-workflow-set.html#creating-the-workflow-set"><span class="toc-section-number">15.2</span> Creating the Workflow Set</a></li>
<li><a href="15.3-tuning-and-evaluating-the-models.html#tuning-and-evaluating-the-models"><span class="toc-section-number">15.3</span> Tuning and Evaluating the Models</a></li>
<li><a href="15.4-racing-example.html#racing-example"><span class="toc-section-number">15.4</span> Efficiently Screening Models</a></li>
<li><a href="15.5-finalizing-a-model.html#finalizing-a-model"><span class="toc-section-number">15.5</span> Finalizing a Model</a></li>
<li><a href="15.6-workflow-sets-summary.html#workflow-sets-summary"><span class="toc-section-number">15.6</span> Chapter Summary</a></li>
</ul></li>
<li class="part"><span><b>Beyond the Basics</b></span></li>
<li class="has-sub"><a href="16-dimensionality.html#dimensionality"><span class="toc-section-number">16</span> Dimensionality Reduction</a>
<ul>
<li><a href="16.1-when-problems-can-dimensionality-reduction-solve.html#when-problems-can-dimensionality-reduction-solve"><span class="toc-section-number">16.1</span> When Problems Can Dimensionality Reduction Solve?</a></li>
<li><a href="16.2-beans.html#beans"><span class="toc-section-number">16.2</span> A Picture is Worth a Thousand… Beans</a></li>
<li><a href="16.3-a-starter-recipe.html#a-starter-recipe"><span class="toc-section-number">16.3</span> A Starter Recipe</a></li>
<li class="has-sub"><a href="16.4-recipe-functions.html#recipe-functions"><span class="toc-section-number">16.4</span> Recipes in the Wild</a>
<ul>
<li><a href="16.4-recipe-functions.html#prep"><span class="toc-section-number">16.4.1</span> Preparing a recipe</a></li>
<li><a href="16.4-recipe-functions.html#bake"><span class="toc-section-number">16.4.2</span> Baking the recipe</a></li>
</ul></li>
<li class="has-sub"><a href="16.5-feature-extraction-techniques.html#feature-extraction-techniques"><span class="toc-section-number">16.5</span> Feature Extraction Techniques</a>
<ul>
<li><a href="16.5-feature-extraction-techniques.html#principal-component-analysis"><span class="toc-section-number">16.5.1</span> Principal component analysis</a></li>
<li><a href="16.5-feature-extraction-techniques.html#partial-least-squares"><span class="toc-section-number">16.5.2</span> Partial least squares</a></li>
<li><a href="16.5-feature-extraction-techniques.html#independent-component-analysis"><span class="toc-section-number">16.5.3</span> Independent component analysis</a></li>
<li><a href="16.5-feature-extraction-techniques.html#uniform-manifold-approximation-and-projection"><span class="toc-section-number">16.5.4</span> Uniform manifold approximation and projection</a></li>
</ul></li>
<li><a href="16.6-bean-models.html#bean-models"><span class="toc-section-number">16.6</span> Modeling</a></li>
<li><a href="16.7-dimensionality-summary.html#dimensionality-summary"><span class="toc-section-number">16.7</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="17-categorical.html#categorical"><span class="toc-section-number">17</span> Encoding Categorical Data</a>
<ul>
<li><a href="17.1-is-an-encoding-necessary.html#is-an-encoding-necessary"><span class="toc-section-number">17.1</span> Is an Encoding Necessary?</a></li>
<li><a href="17.2-encoding-ordinal-predictors.html#encoding-ordinal-predictors"><span class="toc-section-number">17.2</span> Encoding Ordinal Predictors</a></li>
<li class="has-sub"><a href="17.3-using-the-outcome-for-encoding-predictors.html#using-the-outcome-for-encoding-predictors"><span class="toc-section-number">17.3</span> Using the Outcome for Encoding Predictors</a>
<ul>
<li><a href="17.3-using-the-outcome-for-encoding-predictors.html#effect-encodings-with-partial-pooling"><span class="toc-section-number">17.3.1</span> Effect encodings with partial pooling</a></li>
</ul></li>
<li><a href="17.4-feature-hashing.html#feature-hashing"><span class="toc-section-number">17.4</span> Feature Hashing</a></li>
<li><a href="17.5-more-encoding-options.html#more-encoding-options"><span class="toc-section-number">17.5</span> More Encoding Options</a></li>
<li><a href="17.6-categorical-summary.html#categorical-summary"><span class="toc-section-number">17.6</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="18-explain.html#explain"><span class="toc-section-number">18</span> Explaining Models and Predictions</a>
<ul>
<li><a href="18.1-software-for-model-explanations.html#software-for-model-explanations"><span class="toc-section-number">18.1</span> Software for Model Explanations</a></li>
<li><a href="18.2-local-explanations.html#local-explanations"><span class="toc-section-number">18.2</span> Local Explanations</a></li>
<li><a href="18.3-global-explanations.html#global-explanations"><span class="toc-section-number">18.3</span> Global Explanations</a></li>
<li><a href="18.4-building-global-explanations-from-local-explanations.html#building-global-explanations-from-local-explanations"><span class="toc-section-number">18.4</span> Building Global Explanations from Local Explanations</a></li>
<li><a href="18.5-back-to-beans.html#back-to-beans"><span class="toc-section-number">18.5</span> Back to Beans!</a></li>
<li><a href="18.6-explain-summary.html#explain-summary"><span class="toc-section-number">18.6</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="19-trust.html#trust"><span class="toc-section-number">19</span> When Should You Trust Your Predictions?</a>
<ul>
<li><a href="19.1-equivocal-zones.html#equivocal-zones"><span class="toc-section-number">19.1</span> Equivocal Results</a></li>
<li><a href="19.2-applicability-domains.html#applicability-domains"><span class="toc-section-number">19.2</span> Determining Model Applicability</a></li>
<li><a href="19.3-trust-summary.html#trust-summary"><span class="toc-section-number">19.3</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="20-ensembles.html#ensembles"><span class="toc-section-number">20</span> Ensembles of Models</a>
<ul>
<li><a href="20.1-data-stack.html#data-stack"><span class="toc-section-number">20.1</span> Creating the Training Set for Stacking</a></li>
<li><a href="20.2-blend-predictions.html#blend-predictions"><span class="toc-section-number">20.2</span> Blend the Predictions</a></li>
<li><a href="20.3-fit-members.html#fit-members"><span class="toc-section-number">20.3</span> Fit the Member Models</a></li>
<li><a href="20.4-test-set-results.html#test-set-results"><span class="toc-section-number">20.4</span> Test Set Results</a></li>
<li><a href="20.5-ensembles-summary.html#ensembles-summary"><span class="toc-section-number">20.5</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="21-inferential.html#inferential"><span class="toc-section-number">21</span> Inferential Analysis</a>
<ul>
<li><a href="21.1-inference-for-count-data.html#inference-for-count-data"><span class="toc-section-number">21.1</span> Inference for Count Data</a></li>
<li><a href="21.2-comparisons-with-two-sample-tests.html#comparisons-with-two-sample-tests"><span class="toc-section-number">21.2</span> Comparisons with Two-Sample Tests</a></li>
<li><a href="21.3-log-linear-models.html#log-linear-models"><span class="toc-section-number">21.3</span> Log-Linear Models</a></li>
<li><a href="21.4-a-more-complex-model.html#a-more-complex-model"><span class="toc-section-number">21.4</span> A More Complex Model</a></li>
<li><a href="21.5-inference-options.html#inference-options"><span class="toc-section-number">21.5</span> More Inferential Analysis</a></li>
<li><a href="21.6-inference-summary.html#inference-summary"><span class="toc-section-number">21.6</span> Chapter Summary</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li><a href="A-pre-proc-table.html#pre-proc-table"><span class="toc-section-number">A</span> Recommended Preprocessing</a></li>
<li><a href="references.html#references">REFERENCES</a></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="a-more-complex-model" class="section level2" number="21.4">
<h2><span class="header-section-number">21.4</span> A More Complex Model</h2>
<p>We can move into even more complex models within our tidymodels approach. For count data, there are occasions where the number of zero counts is larger than what a simple Poisson distribution would prescribe. A more complex model appropriate in this situation is the zero-inflated Poisson (ZIP) model; see <span class="citation">Mullahy (<a href="#ref-Mullahy" role="doc-biblioref">1986</a>)</span>, <span class="citation">Lambert (<a href="#ref-Lambert1992" role="doc-biblioref">1992</a>)</span>, and <span class="citation">Zeileis, Kleiber, and Jackman (<a href="#ref-JSSv027i08" role="doc-biblioref">2008</a>)</span>. Here, there are two sets of covariates: one for the count data and others that affect the probability (denoted as <span class="math inline">\(\pi\)</span>) of zeros. The equation for the mean <span class="math inline">\(\lambda\)</span> is:</p>
<p><span class="math display">\[\lambda = 0 \pi + (1 - \pi) \lambda_{nz}\]</span></p>
<p>where</p>
<span class="math display">\[\begin{align}
\log(\lambda_{nz}) &amp;= \beta_0 + \beta_1x_1 + \ldots + \beta_px_p \notag \\
\log\left(\frac{\pi}{1-\pi}\right) &amp;= \gamma_0 + \gamma_1z_1 + \ldots + \gamma_qz_q \notag
\end{align}\]</span>
<p>and the <span class="math inline">\(x\)</span> covariates affect the count values while the <span class="math inline">\(z\)</span> covariates influence the probability of a zero. The two sets of predictors do not need to be mutually exclusive.</p>
<p>We’ll fit a model with a full set of <span class="math inline">\(z\)</span> covariates:</p>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="21.4-a-more-complex-model.html#cb365-1" aria-hidden="true" tabindex="-1"></a>zero_inflated_spec <span class="ot">&lt;-</span> <span class="fu">poisson_reg</span>() <span class="sc">%&gt;%</span> <span class="fu">set_engine</span>(<span class="st">&quot;zeroinfl&quot;</span>)</span>
<span id="cb365-2"><a href="21.4-a-more-complex-model.html#cb365-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb365-3"><a href="21.4-a-more-complex-model.html#cb365-3" aria-hidden="true" tabindex="-1"></a>zero_inflated_fit <span class="ot">&lt;-</span> </span>
<span id="cb365-4"><a href="21.4-a-more-complex-model.html#cb365-4" aria-hidden="true" tabindex="-1"></a>  zero_inflated_spec <span class="sc">%&gt;%</span> </span>
<span id="cb365-5"><a href="21.4-a-more-complex-model.html#cb365-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(art <span class="sc">~</span> fem <span class="sc">+</span> mar <span class="sc">+</span> kid5 <span class="sc">+</span> ment <span class="sc">|</span> fem <span class="sc">+</span> mar <span class="sc">+</span> kid5 <span class="sc">+</span> phd <span class="sc">+</span> ment,</span>
<span id="cb365-6"><a href="21.4-a-more-complex-model.html#cb365-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> bioChemists)</span>
<span id="cb365-7"><a href="21.4-a-more-complex-model.html#cb365-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb365-8"><a href="21.4-a-more-complex-model.html#cb365-8" aria-hidden="true" tabindex="-1"></a>zero_inflated_fit</span>
<span id="cb365-9"><a href="21.4-a-more-complex-model.html#cb365-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; parsnip model object</span></span>
<span id="cb365-10"><a href="21.4-a-more-complex-model.html#cb365-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb365-11"><a href="21.4-a-more-complex-model.html#cb365-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb365-12"><a href="21.4-a-more-complex-model.html#cb365-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Call:</span></span>
<span id="cb365-13"><a href="21.4-a-more-complex-model.html#cb365-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; pscl::zeroinfl(formula = art ~ fem + mar + kid5 + ment | fem + mar + kid5 + </span></span>
<span id="cb365-14"><a href="21.4-a-more-complex-model.html#cb365-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     phd + ment, data = data)</span></span>
<span id="cb365-15"><a href="21.4-a-more-complex-model.html#cb365-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb365-16"><a href="21.4-a-more-complex-model.html#cb365-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Count model coefficients (poisson with log link):</span></span>
<span id="cb365-17"><a href="21.4-a-more-complex-model.html#cb365-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; (Intercept)     femWomen   marMarried         kid5         ment  </span></span>
<span id="cb365-18"><a href="21.4-a-more-complex-model.html#cb365-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       0.621       -0.209        0.105       -0.143        0.018  </span></span>
<span id="cb365-19"><a href="21.4-a-more-complex-model.html#cb365-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb365-20"><a href="21.4-a-more-complex-model.html#cb365-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Zero-inflation model coefficients (binomial with logit link):</span></span>
<span id="cb365-21"><a href="21.4-a-more-complex-model.html#cb365-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; (Intercept)     femWomen   marMarried         kid5          phd         ment  </span></span>
<span id="cb365-22"><a href="21.4-a-more-complex-model.html#cb365-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     -0.6086       0.1093      -0.3529       0.2195       0.0124      -0.1351</span></span></code></pre></div>
<p>Since the coefficients for this model are also estimated using maximum likelihood, let’s try to use another likelihood ratio test to understand if the new model terms are helpful. We will <em>simultaneously</em> test that:</p>
<span class="math display">\[\begin{align}
H_0&amp;: \gamma_1 = 0, \gamma_2 = 0, \cdots, \gamma_5 = 0 \notag \\
H_a&amp;: \text{at least one } \gamma \ne 0  \notag
\end{align}\]</span>
<p>Let’s try ANOVA again:</p>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="21.4-a-more-complex-model.html#cb366-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(</span>
<span id="cb366-2"><a href="21.4-a-more-complex-model.html#cb366-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_engine</span>(zero_inflated_fit),</span>
<span id="cb366-3"><a href="21.4-a-more-complex-model.html#cb366-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_engine</span>(log_lin_reduced),</span>
<span id="cb366-4"><a href="21.4-a-more-complex-model.html#cb366-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">test =</span> <span class="st">&quot;LRT&quot;</span></span>
<span id="cb366-5"><a href="21.4-a-more-complex-model.html#cb366-5" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb366-6"><a href="21.4-a-more-complex-model.html#cb366-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()</span>
<span id="cb366-7"><a href="21.4-a-more-complex-model.html#cb366-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Error in UseMethod(&quot;anova&quot;): no applicable method for &#39;anova&#39; applied to an object of class &quot;zeroinfl&quot;</span></span></code></pre></div>
<p>An <code>anova()</code> method isn’t implemented for <code>zeroinfl</code> objects!</p>
<p>An alternative is to use an <em>information criterion statistic</em>, such as the Akaike information criterion (AIC) <span class="citation">(<a href="#ref-claeskens2016statistical" role="doc-biblioref">Claeskens 2016</a>)</span>. This computes the log-likelihood (from the training set) and penalizes that value based on the training set size and the number of model parameters. In R’s parameterization, smaller AIC values are better. In this case, we are not conducting a formal statistical test but <em>estimating</em> the ability of the data to fit the data.</p>
<p>The results indicate that the ZIP model is preferable:</p>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="21.4-a-more-complex-model.html#cb367-1" aria-hidden="true" tabindex="-1"></a>zero_inflated_fit <span class="sc">%&gt;%</span> <span class="fu">extract_fit_engine</span>() <span class="sc">%&gt;%</span> <span class="fu">AIC</span>()</span>
<span id="cb367-2"><a href="21.4-a-more-complex-model.html#cb367-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 3232</span></span>
<span id="cb367-3"><a href="21.4-a-more-complex-model.html#cb367-3" aria-hidden="true" tabindex="-1"></a>log_lin_reduced   <span class="sc">%&gt;%</span> <span class="fu">extract_fit_engine</span>() <span class="sc">%&gt;%</span> <span class="fu">AIC</span>()</span>
<span id="cb367-4"><a href="21.4-a-more-complex-model.html#cb367-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 3312</span></span></code></pre></div>
<p>However, it’s hard to contextualize this pair of single values and assess <em>how</em> different they actually are. To solve this problem, we’ll resample a large number of each of these two models. From these, we can compute the AIC values for each and determine how often the results favor the ZIP model. Basically, we will be characterizing the uncertainty of the AIC statistics to gauge their difference relative to the noise in the data.</p>
<p>We’ll also compute more bootstrap confidence intervals for the parameters in a bit so we specify the <code>apparent = TRUE</code> option when creating the bootstrap samples. This is required for some types of intervals.</p>
<p>First, we create the 4,000 model fits:</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="21.4-a-more-complex-model.html#cb368-1" aria-hidden="true" tabindex="-1"></a>zip_form <span class="ot">&lt;-</span> art <span class="sc">~</span> fem <span class="sc">+</span> mar <span class="sc">+</span> kid5 <span class="sc">+</span> ment <span class="sc">|</span> fem <span class="sc">+</span> mar <span class="sc">+</span> kid5 <span class="sc">+</span> phd <span class="sc">+</span> ment</span>
<span id="cb368-2"><a href="21.4-a-more-complex-model.html#cb368-2" aria-hidden="true" tabindex="-1"></a>glm_form <span class="ot">&lt;-</span> art <span class="sc">~</span> fem <span class="sc">+</span> mar <span class="sc">+</span> kid5 <span class="sc">+</span> ment</span>
<span id="cb368-3"><a href="21.4-a-more-complex-model.html#cb368-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb368-4"><a href="21.4-a-more-complex-model.html#cb368-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2104</span>)</span>
<span id="cb368-5"><a href="21.4-a-more-complex-model.html#cb368-5" aria-hidden="true" tabindex="-1"></a>bootstrap_models <span class="ot">&lt;-</span></span>
<span id="cb368-6"><a href="21.4-a-more-complex-model.html#cb368-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bootstraps</span>(bioChemists, <span class="at">times =</span> <span class="dv">2000</span>, <span class="at">apparent =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb368-7"><a href="21.4-a-more-complex-model.html#cb368-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb368-8"><a href="21.4-a-more-complex-model.html#cb368-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">glm =</span> <span class="fu">map</span>(splits, <span class="sc">~</span> <span class="fu">fit</span>(log_lin_spec,       glm_form, <span class="at">data =</span> <span class="fu">analysis</span>(.x))),</span>
<span id="cb368-9"><a href="21.4-a-more-complex-model.html#cb368-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">zip =</span> <span class="fu">map</span>(splits, <span class="sc">~</span> <span class="fu">fit</span>(zero_inflated_spec, zip_form, <span class="at">data =</span> <span class="fu">analysis</span>(.x)))</span>
<span id="cb368-10"><a href="21.4-a-more-complex-model.html#cb368-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb368-11"><a href="21.4-a-more-complex-model.html#cb368-11" aria-hidden="true" tabindex="-1"></a>bootstrap_models</span>
<span id="cb368-12"><a href="21.4-a-more-complex-model.html#cb368-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # Bootstrap sampling with apparent sample </span></span>
<span id="cb368-13"><a href="21.4-a-more-complex-model.html#cb368-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2,001 × 4</span></span>
<span id="cb368-14"><a href="21.4-a-more-complex-model.html#cb368-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   splits            id            glm      zip     </span></span>
<span id="cb368-15"><a href="21.4-a-more-complex-model.html#cb368-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;list&gt;            &lt;chr&gt;         &lt;list&gt;   &lt;list&gt;  </span></span>
<span id="cb368-16"><a href="21.4-a-more-complex-model.html#cb368-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 &lt;split [915/355]&gt; Bootstrap0001 &lt;fit[+]&gt; &lt;fit[+]&gt;</span></span>
<span id="cb368-17"><a href="21.4-a-more-complex-model.html#cb368-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 &lt;split [915/333]&gt; Bootstrap0002 &lt;fit[+]&gt; &lt;fit[+]&gt;</span></span>
<span id="cb368-18"><a href="21.4-a-more-complex-model.html#cb368-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 &lt;split [915/337]&gt; Bootstrap0003 &lt;fit[+]&gt; &lt;fit[+]&gt;</span></span>
<span id="cb368-19"><a href="21.4-a-more-complex-model.html#cb368-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 &lt;split [915/344]&gt; Bootstrap0004 &lt;fit[+]&gt; &lt;fit[+]&gt;</span></span>
<span id="cb368-20"><a href="21.4-a-more-complex-model.html#cb368-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 &lt;split [915/351]&gt; Bootstrap0005 &lt;fit[+]&gt; &lt;fit[+]&gt;</span></span>
<span id="cb368-21"><a href="21.4-a-more-complex-model.html#cb368-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 &lt;split [915/354]&gt; Bootstrap0006 &lt;fit[+]&gt; &lt;fit[+]&gt;</span></span>
<span id="cb368-22"><a href="21.4-a-more-complex-model.html#cb368-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 1,995 more rows</span></span></code></pre></div>
<p>Now we can extract the model fits and their corresponding AIC values:</p>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb369-1"><a href="21.4-a-more-complex-model.html#cb369-1" aria-hidden="true" tabindex="-1"></a>bootstrap_models <span class="ot">&lt;-</span></span>
<span id="cb369-2"><a href="21.4-a-more-complex-model.html#cb369-2" aria-hidden="true" tabindex="-1"></a>  bootstrap_models <span class="sc">%&gt;%</span></span>
<span id="cb369-3"><a href="21.4-a-more-complex-model.html#cb369-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb369-4"><a href="21.4-a-more-complex-model.html#cb369-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">glm_aic =</span> <span class="fu">map_dbl</span>(glm, <span class="sc">~</span> <span class="fu">extract_fit_engine</span>(.x) <span class="sc">%&gt;%</span> <span class="fu">AIC</span>()),</span>
<span id="cb369-5"><a href="21.4-a-more-complex-model.html#cb369-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">zip_aic =</span> <span class="fu">map_dbl</span>(zip, <span class="sc">~</span> <span class="fu">extract_fit_engine</span>(.x) <span class="sc">%&gt;%</span> <span class="fu">AIC</span>()),</span>
<span id="cb369-6"><a href="21.4-a-more-complex-model.html#cb369-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb369-7"><a href="21.4-a-more-complex-model.html#cb369-7" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(bootstrap_models<span class="sc">$</span>zip_aic <span class="sc">&lt;</span> bootstrap_models<span class="sc">$</span>glm_aic)</span>
<span id="cb369-8"><a href="21.4-a-more-complex-model.html#cb369-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1</span></span></code></pre></div>
<p>It seems definitive from these results that accounting for the excessive number of zero counts is a good idea.</p>
<div class="rmdnote">
<p>We could have used <code>fit_resamples()</code> or a workflow set to conduct these computations. In this section, we used <code>mutate()</code> and <code>map()</code> to compute the models to demonstrate how one might use tidymodels tools for models that are not supported by one of the <span class="pkg">parsnip</span> packages.</p>
</div>
<p>Since we have computed the resampled model fits, let’s create bootstrap intervals for the zero probability model coefficients (i.e., the <span class="math inline">\(\gamma_j\)</span>). We can extract these with the <code>tidy()</code> method and use the <code>type = "zero"</code> option to obtain these estimates:</p>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="21.4-a-more-complex-model.html#cb370-1" aria-hidden="true" tabindex="-1"></a>bootstrap_models <span class="ot">&lt;-</span></span>
<span id="cb370-2"><a href="21.4-a-more-complex-model.html#cb370-2" aria-hidden="true" tabindex="-1"></a>  bootstrap_models <span class="sc">%&gt;%</span></span>
<span id="cb370-3"><a href="21.4-a-more-complex-model.html#cb370-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">zero_coefs  =</span> <span class="fu">map</span>(zip, <span class="sc">~</span> <span class="fu">tidy</span>(.x, <span class="at">type =</span> <span class="st">&quot;zero&quot;</span>)))</span>
<span id="cb370-4"><a href="21.4-a-more-complex-model.html#cb370-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb370-5"><a href="21.4-a-more-complex-model.html#cb370-5" aria-hidden="true" tabindex="-1"></a><span class="co"># One example:</span></span>
<span id="cb370-6"><a href="21.4-a-more-complex-model.html#cb370-6" aria-hidden="true" tabindex="-1"></a>bootstrap_models<span class="sc">$</span>zero_coefs[[<span class="dv">1</span>]]</span>
<span id="cb370-7"><a href="21.4-a-more-complex-model.html#cb370-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 6</span></span>
<span id="cb370-8"><a href="21.4-a-more-complex-model.html#cb370-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   term        type  estimate std.error statistic   p.value</span></span>
<span id="cb370-9"><a href="21.4-a-more-complex-model.html#cb370-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span id="cb370-10"><a href="21.4-a-more-complex-model.html#cb370-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 (Intercept) zero   -0.128     0.497     -0.257 0.797    </span></span>
<span id="cb370-11"><a href="21.4-a-more-complex-model.html#cb370-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 femWomen    zero   -0.0764    0.319     -0.240 0.811    </span></span>
<span id="cb370-12"><a href="21.4-a-more-complex-model.html#cb370-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 marMarried  zero   -0.112     0.365     -0.307 0.759    </span></span>
<span id="cb370-13"><a href="21.4-a-more-complex-model.html#cb370-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 kid5        zero    0.270     0.186      1.45  0.147    </span></span>
<span id="cb370-14"><a href="21.4-a-more-complex-model.html#cb370-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 phd         zero   -0.178     0.132     -1.35  0.177    </span></span>
<span id="cb370-15"><a href="21.4-a-more-complex-model.html#cb370-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 ment        zero   -0.123     0.0315    -3.91  0.0000935</span></span></code></pre></div>
<p>It’s a good idea to visualize the bootstrap distributions of the coefficients, as in Figure <a href="21.4-a-more-complex-model.html#fig:zip-bootstrap">21.5</a>.</p>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb371-1"><a href="21.4-a-more-complex-model.html#cb371-1" aria-hidden="true" tabindex="-1"></a>bootstrap_models <span class="sc">%&gt;%</span> </span>
<span id="cb371-2"><a href="21.4-a-more-complex-model.html#cb371-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(zero_coefs) <span class="sc">%&gt;%</span> </span>
<span id="cb371-3"><a href="21.4-a-more-complex-model.html#cb371-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> estimate)) <span class="sc">+</span></span>
<span id="cb371-4"><a href="21.4-a-more-complex-model.html#cb371-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">25</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span> </span>
<span id="cb371-5"><a href="21.4-a-more-complex-model.html#cb371-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> term, <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span> </span>
<span id="cb371-6"><a href="21.4-a-more-complex-model.html#cb371-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;gray70&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:zip-bootstrap"></span>
<img src="figures/zip-bootstrap-1.png" alt="Bootstrap distributions of the ZIP model coefficients. The vertical lines indicate the observed estimates. The ment predictor that appears to be important to the model."  />
<p class="caption">
Figure 21.5: Bootstrap distributions of the ZIP model coefficients. The vertical lines indicate the observed estimates.
</p>
</div>
<p>From visual inspection, one of the covariates (<code>ment</code>) that appears to be important has a very skewed distribution. The extra space in some of the facets indicates that there are some outliers in the estimates. This <em>might</em> occur when models did not converge; those results should probably be excluded from the resamples. For the results visualized in Figure <a href="21.4-a-more-complex-model.html#fig:zip-bootstrap">21.5</a>, the outliers are only due to extreme parameter estimates; all of the models converged.</p>
<p>The <span class="pkg">rsample</span> package contains a set of functions named <code>int_*()</code> that compute different types of bootstrap intervals. Since the <code>tidy()</code> method contains standard error estimates, the bootstrap-t intervals can be computed. We’ll also compute the standard percentile intervals too. By default, 90% confidence intervals are computed.</p>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="21.4-a-more-complex-model.html#cb372-1" aria-hidden="true" tabindex="-1"></a>bootstrap_models <span class="sc">%&gt;%</span> <span class="fu">int_pctl</span>(zero_coefs)</span>
<span id="cb372-2"><a href="21.4-a-more-complex-model.html#cb372-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 6</span></span>
<span id="cb372-3"><a href="21.4-a-more-complex-model.html#cb372-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   term        .lower .estimate  .upper .alpha .method   </span></span>
<span id="cb372-4"><a href="21.4-a-more-complex-model.html#cb372-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;     </span></span>
<span id="cb372-5"><a href="21.4-a-more-complex-model.html#cb372-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 (Intercept) -1.75    -0.621   0.423    0.05 percentile</span></span>
<span id="cb372-6"><a href="21.4-a-more-complex-model.html#cb372-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 femWomen    -0.521    0.115   0.818    0.05 percentile</span></span>
<span id="cb372-7"><a href="21.4-a-more-complex-model.html#cb372-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 kid5        -0.327    0.218   0.677    0.05 percentile</span></span>
<span id="cb372-8"><a href="21.4-a-more-complex-model.html#cb372-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 marMarried  -1.20    -0.381   0.362    0.05 percentile</span></span>
<span id="cb372-9"><a href="21.4-a-more-complex-model.html#cb372-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 ment        -0.401   -0.162  -0.0513   0.05 percentile</span></span>
<span id="cb372-10"><a href="21.4-a-more-complex-model.html#cb372-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 phd         -0.276    0.0220  0.327    0.05 percentile</span></span>
<span id="cb372-11"><a href="21.4-a-more-complex-model.html#cb372-11" aria-hidden="true" tabindex="-1"></a>bootstrap_models <span class="sc">%&gt;%</span> <span class="fu">int_t</span>(zero_coefs)</span>
<span id="cb372-12"><a href="21.4-a-more-complex-model.html#cb372-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 6</span></span>
<span id="cb372-13"><a href="21.4-a-more-complex-model.html#cb372-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   term        .lower .estimate  .upper .alpha .method  </span></span>
<span id="cb372-14"><a href="21.4-a-more-complex-model.html#cb372-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;    </span></span>
<span id="cb372-15"><a href="21.4-a-more-complex-model.html#cb372-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 (Intercept) -1.61    -0.621   0.321    0.05 student-t</span></span>
<span id="cb372-16"><a href="21.4-a-more-complex-model.html#cb372-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 femWomen    -0.482    0.115   0.671    0.05 student-t</span></span>
<span id="cb372-17"><a href="21.4-a-more-complex-model.html#cb372-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 kid5        -0.211    0.218   0.599    0.05 student-t</span></span>
<span id="cb372-18"><a href="21.4-a-more-complex-model.html#cb372-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 marMarried  -0.988   -0.381   0.290    0.05 student-t</span></span>
<span id="cb372-19"><a href="21.4-a-more-complex-model.html#cb372-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 ment        -0.324   -0.162  -0.0275   0.05 student-t</span></span>
<span id="cb372-20"><a href="21.4-a-more-complex-model.html#cb372-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 phd         -0.274    0.0220  0.291    0.05 student-t</span></span></code></pre></div>
<p>From these results, we can get a good idea of which predictor(s) to include in the zero count probability model. It may be sensible to refit a smaller model to assess if the bootstrap distribution for <code>ment</code> is still skewed.</p>
</div>
<h3>REFERENCES</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-claeskens2016statistical" class="csl-entry">
Claeskens, G. 2016. <span>“Statistical Model Choice.”</span> <em>Annual Review of Statistics and Its Application</em> 3: 233–56.
</div>
<div id="ref-Lambert1992" class="csl-entry">
Lambert, D. 1992. <span>“Zero-Inflated Poisson Regression, with an Application to Defects in Manufacturing.”</span> <em>Technometrics</em> 34 (1): 1–14.
</div>
<div id="ref-Mullahy" class="csl-entry">
Mullahy, J. 1986. <span>“Specification and Testing of Some Modified Count Data Models.”</span> <em>Journal of Econometrics</em> 33 (3): 341–65.
</div>
<div id="ref-JSSv027i08" class="csl-entry">
Zeileis, A, C Kleiber, and S Jackman. 2008. <span>“Regression Models for Count Data in <span>R</span>.”</span> <em>Journal of Statistical Software</em> 27 (8): 1–25. <a href="https://www.jstatsoft.org/v027/i08">https://www.jstatsoft.org/v027/i08</a>.
</div>
</div>
<p style="text-align: center;">
<a href="21.3-log-linear-models.html"><button class="btn btn-default">Previous</button></a>
<a href="21.5-inference-options.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

</body>
</html>
